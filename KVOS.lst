; da65 V2.15
; Created:    2017-04-20 15:21:52
; Input file: F000-FFFF-combined-modified.rom
; Page:       1


        .setcpu "6502"

; ----------------------------------------------------------------------------
L0004           := $0004
DDLO            := $00DD       ; ??? LOW BYTE
DDHI            := $00DE       ; ??? HIGH BYTE
INPUTLB         := $00E7       ; 5D
INPUTHB         := $00E8       ; BF
T3LB            := $00E9       ; A7
T3HB            := $00EA       ; BF
CHARLO          := $00F1       ; CHARACTER ROM POSITION LOW BYTE
CHARHI          := $00F2       ; CHARACTER ROM POSITION HIGH BYTE
SCRNLO          := $00FB       ; SCREEN POSITION LOW BYTE
SCRNHI          := $00FC       ; SCREEN POSITION HIGH BYTE
6522-INPUTB     := $1580
6522-INPUTA     := $1581
6522-DDRB       := $1582
6522-DDRA       := $1583
6522-T1CL       := $1584
6522-T1CH       := $1585
6522-T1LL       := $1586
6522-T1LH       := $1587
6522-T2LL       := $1588
6522-T2CH       := $1589
6522-SR         := $158A
6522-ACR        := $158B
6522-PCR        := $158C
6522-IFR        := $158D
6522-IER        := $158E
6522-ORAX       := $158F
JUMP TABLE      := $1600       ; JUMP TABLE
L1602           := $1602
L1604           := $1604
L1606           := $1606
L1608           := $1608
L160C           := $160C
L160E           := $160E
L1612           := $1612
6530IO          := $1700       ; IO & Timer for 6530-003
6530PADD        := $1701       ; 6530-003 A Data Direction Register
6530PBD         := $1702       ; 6530-003 B Data Register
6530PBDD        := $1703       ; 6530-003 B Data Direction Register
6530APIO        := $1733       ; 6530-003 Application IO
6530APIO2       := $1734       ; 6530-003 Application IO
NMI             := $1C1C
IRQ             := $1C1F
KIMRST          := $1C22       ; KIM ENTRY VIA RST, 6530-002
XTMP1           := $BF49       ; TEMPORARY STORAGE FOR X REG
YTMP1           := $BF4A       ; TEMPORARY STORAGE FOR Y REG
XTMP2           := $BF4B       ; TEMPORARY STORAGE FOR X REG
YTMP2           := $BF4C       ; TEMPORARY STORAGE FOR Y REG
XTMP3           := $BF4D       ; TEMPORARY STORAGE FOR X REG
TBL1            := $BF51       ; DATA TABLE 1, SET AT F1EF
INPUTBUFFER     := $BF5D       ; SET AT F2E1
TBL3            := $BFA7       ; SET AT F2EC
ZEROES          := $FDE2
; ----------------------------------------------------------------------------
CHARACTER ROM:
        .byte   $00,$00,$00,$00,$00,$04,$20,$00; F000 00 00 00 00 00 04 20 00   ...... .
        .byte   $24,$04,$00,$40,$80,$40,$8A,$0A; F008 24 04 00 40 80 40 8A 0A   $..@.@..
        .byte   $4A,$9F,$4A,$9F,$04,$7E,$C5,$2E; F010 4A 9F 4A 9F 04 7E C5 2E   J.J..~..
        .byte   $14,$01,$91,$48,$84,$02,$0D,$52; F018 14 01 91 48 84 02 0D 52   ...H...R
        .byte   $95,$2C,$0A,$00,$40,$00,$20,$10; F020 95 2C 0A 00 40 00 20 10   .,..@. .
        .byte   $04,$48,$10,$30,$10,$04,$02,$81; F028 04 48 10 30 10 04 02 81   .H.0....
        .byte   $21,$01,$00,$24,$15,$0E,$15,$00; F030 21 01 00 24 15 0E 15 00   !..$....
        .byte   $24,$04,$1F,$04,$80,$04,$02,$02; F038 24 04 1F 04 80 04 02 02   $.......
        .byte   $00,$00,$00,$00,$1F,$00,$04,$04; F040 00 00 00 00 1F 00 04 04   ........
        .byte   $00,$00,$00,$00,$10,$48,$04,$02; F048 00 00 00 00 10 48 04 02   .....H..
        .byte   $0C,$92,$92,$72,$12,$0E,$64,$04; F050 0C 92 92 72 12 0E 64 04   ...r..d.
        .byte   $24,$04,$1F,$88,$44,$62,$81,$0E; F058 24 04 1F 88 44 62 81 0E   $...Db..
        .byte   $91,$41,$66,$81,$02,$22,$9F,$12; F060 91 41 66 81 02 22 9F 12   .Af.."..
        .byte   $8A,$0E,$91,$01,$E1,$DE,$0E,$51; F068 8A 0E 91 01 E1 DE 0E 51   .......Q
        .byte   $11,$3E,$90,$08,$08,$48,$E4,$C2; F070 11 3E 90 08 08 48 E4 C2   .>...H..
        .byte   $0E,$91,$51,$6E,$91,$0C,$82,$41; F078 0E 91 51 6E 91 0C 82 41   ..Qn...A
        .byte   $6F,$91,$00,$24,$04,$00,$04,$80; F080 6F 91 00 24 04 00 04 80   o..$....
        .byte   $28,$04,$24,$00,$02,$24,$08,$10; F088 28 04 24 00 02 24 08 10   (.$..$..
        .byte   $88,$00,$00,$1F,$00,$1F,$08,$24; F090 88 00 00 1F 00 1F 08 24   .......$
        .byte   $02,$41,$02,$04,$80,$44,$64,$82; F098 02 41 02 04 80 44 64 82   .A...Dd.
        .byte   $0E,$90,$57,$75,$97,$11,$91,$51; F0A0 0E 90 57 75 97 11 91 51   ..Wu...Q
        .byte   $7F,$91,$1E,$91,$51,$FE,$91,$0E; F0A8 7F 91 1E 91 51 FE 91 0E   ....Q...
        .byte   $91,$50,$70,$90,$1C,$92,$91,$F1; F0B0 91 50 70 90 1C 92 91 F1   .Pp.....
        .byte   $11,$1F,$90,$10,$FE,$D0,$10,$90; F0B8 11 1F 90 10 FE D0 10 90   ........
        .byte   $10,$FE,$D0,$0F,$91,$11,$73,$D0; F0C0 10 FE D0 0F 91 11 73 D0   ......s.
        .byte   $11,$91,$51,$9F,$51,$0E,$24,$04; F0C8 11 91 51 9F 51 0E 24 04   ..Q.Q.$.
        .byte   $64,$84,$0C,$12,$82,$62,$C2,$11; F0D0 64 84 0C 12 82 62 C2 11   d....b..
        .byte   $92,$94,$98,$54,$1F,$90,$10,$90; F0D8 92 94 98 54 1F 90 10 90   ...T....
        .byte   $10,$11,$D1,$D1,$95,$55,$11,$91; F0E0 10 11 D1 D1 95 55 11 91   .....U..
        .byte   $53,$95,$59,$0E,$91,$51,$71,$91; F0E8 53 95 59 0E 91 51 71 91   S.Y..Qq.
        .byte   $10,$90,$50,$FE,$91,$0D,$92,$55; F0F0 10 90 50 FE 91 0D 92 55   ..P....U
        .byte   $71,$91,$11,$92,$54,$FE,$91,$1E; F0F8 71 91 11 92 54 FE 91 1E   q...T...
        .byte   $81,$01,$6E,$D0,$04,$24,$04,$E4; F100 81 01 6E D0 04 24 04 E4   ..n..$..
        .byte   $C4,$0E,$91,$51,$91,$51,$04,$8A; F108 C4 0E 91 51 91 51 04 8A   ...Q.Q..
        .byte   $51,$91,$51,$0A,$95,$55,$95,$51; F110 51 91 51 0A 95 55 95 51   Q.Q..U.Q
        .byte   $11,$91,$4A,$84,$4A,$04,$84,$44; F118 11 91 4A 84 4A 04 84 44   ..J.J..D
        .byte   $8A,$51,$1F,$10,$48,$E4,$C2,$1C; F120 8A 51 1F 10 48 E4 C2 1C   .Q..H...
        .byte   $90,$10,$F0,$10,$00,$81,$02,$04; F128 90 10 F0 10 00 81 02 04   ........
        .byte   $08,$07,$01,$41,$21,$C1,$00,$40; F130 08 07 01 41 21 C1 00 40   ...A!..@
        .byte   $80,$20,$11,$1F,$00,$00,$00,$00; F138 80 20 11 1F 00 00 00 00   . ......
        .byte   $00,$40,$00,$80,$04,$0F,$11,$0F; F140 00 40 00 80 04 0F 11 0F   .@......
        .byte   $01,$0E,$1E,$91,$11,$9E,$10,$0E; F148 01 0E 1E 91 11 9E 10 0E   ........
        .byte   $10,$10,$10,$0E,$0F,$11,$51,$0F; F150 10 10 10 0E 0F 11 51 0F   ......Q.
        .byte   $41,$0C,$10,$1E,$12,$0C,$08,$48; F158 41 0C 10 1E 12 0C 08 48   A......H
        .byte   $88,$3C,$08,$8C,$62,$0E,$12,$12; F160 88 3C 08 8C 62 0E 12 12   .<..b...
        .byte   $12,$92,$12,$9C,$10,$0E,$24,$04; F168 12 92 12 9C 10 0E 24 04   ......$.
        .byte   $0C,$00,$84,$0A,$02,$02,$82,$12; F170 0C 00 84 0A 02 02 82 12   ........
        .byte   $94,$18,$94,$10,$0E,$24,$04,$64; F178 94 18 94 10 0E 24 04 64   .....$.d
        .byte   $04,$11,$11,$15,$15,$0A,$12,$12; F180 04 11 11 15 15 0A 12 12   ........
        .byte   $12,$12,$0C,$0C,$12,$12,$12,$0C; F188 12 12 0C 0C 12 12 12 0C   ........
        .byte   $90,$F0,$1C,$12,$12,$83,$62,$8E; F190 90 F0 1C 12 12 83 62 8E   ......b.
        .byte   $12,$12,$10,$10,$10,$18,$16,$0E; F198 12 12 10 10 10 18 16 0E   ........
        .byte   $01,$0E,$10,$0E,$02,$24,$04,$04; F1A0 01 0E 10 0E 02 24 04 04   .....$..
        .byte   $0E,$0F,$12,$12,$12,$12,$04,$0A; F1A8 0E 0F 12 12 12 12 04 0A   ........
        .byte   $11,$11,$11,$0A,$15,$15,$11,$11; F1B0 11 11 11 0A 15 15 11 11   ........
        .byte   $11,$0A,$04,$0A,$11,$8C,$82,$8E; F1B8 11 0A 04 0A 11 8C 82 8E   ........
        .byte   $12,$12,$1F,$08,$04,$02,$1F,$03; F1C0 12 12 1F 08 04 02 1F 03   ........
        .byte   $04,$84,$18,$C4,$04,$24,$04,$20; F1C8 04 84 18 C4 04 24 04 20   .....$. 
        .byte   $04,$18,$24,$04,$C3,$04,$00,$00; F1D0 04 18 24 04 C3 04 00 00   ..$.....
        .byte   $02,$15,$08,$15,$4A,$95,$AA,$55; F1D8 02 15 08 15 4A 95 AA 55   ....J..U
; ----------------------------------------------------------------------------
; SETS UP DATA TABLE 1 AT BF51
T1:     ldx     #$00           ; F1E0 A2 00                                     ..
; GETS 8 CHARACTERS FROM BUFFER, PUTS THEM IN TBL1 AT $BF51
CHARTOT1:
        jsr     GETCHAR2       ; F1E2 20 A8 F3                                   ..
        beq     N/S/E          ; F1E5 F0 11                                     ..
        cmp     #$20           ; F1E7 C9 20                                     . 
        beq     N/S/E          ; F1E9 F0 0D                                     ..
        cmp     #$3D           ; F1EB C9 3D                                     .=
        beq     N/S/E          ; F1ED F0 09                                     ..
        sta     TBL1,x         ; F1EF 9D 51 BF                                  .Q.
        inx                    ; F1F2 E8                                        .
        iny                    ; F1F3 C8                                        .
        cpx     #$08           ; F1F4 E0 08                                     ..
        bne     CHARTOT1       ; F1F6 D0 EA                                     ..
; IF NULL/SPACE/EQUALS, PUT ZERO IN TBL1, GET NEXT CHAR
N/S/E:  lda     #$00           ; F1F8 A9 00                                     ..
        sta     TBL1,x         ; F1FA 9D 51 BF                                  .Q.
        jsr     NEXTCHAR       ; F1FD 20 9D F3                                   ..
        rts                    ; F200 60                                        `

; ----------------------------------------------------------------------------
; ???
???:    .byte   $0B            ; F201 0B                                        .
        brk                    ; F202 00                                        .
        brk                    ; F203 00                                        .
        brk                    ; F204 00                                        .
        .byte   $0C            ; F205 0C                                        .
        bne     IS R?          ; F206 D0 03                                     ..
        jmp     LF306          ; F208 4C 06 F3                                  L..

; ----------------------------------------------------------------------------
IS R?:  cmp     #$52           ; F20B C9 52                                     .R
        bne     NOT R          ; F20D D0 01                                     ..
        iny                    ; F20F C8                                        .
NOT R:  jsr     DO R           ; F210 20 31 FA                                   1.
        sta     DDLO           ; F213 85 DD                                     ..
        lda     #$16           ; F215 A9 16                                     ..
        sta     DDHI           ; F217 85 DE                                     ..
        jsr     NEXTCHAR       ; F219 20 9D F3                                   ..
        cmp     #$3D           ; F21C C9 3D                                     .=
        beq     ISEQUALS       ; F21E F0 03                                     ..
        jmp     (L1612)        ; F220 6C 12 16                                  l..

; ----------------------------------------------------------------------------
; CHECKS FOR EQUALS
ISEQUALS:
        iny                    ; F223 C8                                        .
        jsr     LFAD7          ; F224 20 D7 FA                                   ..
        ldx     #$00           ; F227 A2 00                                     ..
        sta     (DDLO,x)       ; F229 81 DD                                     ..
        jsr     NEXTCHAR       ; F22B 20 9D F3                                   ..
        bne     IS R?          ; F22E D0 DB                                     ..
        rts                    ; F230 60                                        `

; ----------------------------------------------------------------------------
        jsr     LFAF2          ; F231 20 F2 FA                                   ..
        jsr     NEXTCHAR       ; F234 20 9D F3                                   ..
        bne     EQUALS         ; F237 D0 08                                     ..
        ldx     #$DF           ; F239 A2 DF                                     ..
        jsr     DDtoDF         ; F23B 20 B0 FB                                   ..
LF23E:  jmp     LF2A5          ; F23E 4C A5 F2                                  L..

; ----------------------------------------------------------------------------
; CHECKS FOR EQUALS
EQUALS: lda     (INPUTLB),y    ; F241 B1 E7                                     ..
        cmp     #$3D           ; F243 C9 3D                                     .=
        beq     GETCHAR1       ; F245 F0 16                                     ..
        jsr     DO W           ; F247 20 EE FA                                   ..
        jsr     NEXTCHAR       ; F24A 20 9D F3                                   ..
        beq     LF23E          ; F24D F0 EF                                     ..
        cmp     #$3D           ; F24F C9 3D                                     .=
        beq     LF256          ; F251 F0 03                                     ..
LF253:  jmp     (L1612)        ; F253 6C 12 16                                  l..

; ----------------------------------------------------------------------------
LF256:  iny                    ; F256 C8                                        .
        jsr     LFAD7          ; F257 20 D7 FA                                   ..
        jmp     LFC3B          ; F25A 4C 3B FC                                  L;.

; ----------------------------------------------------------------------------
; GET CHAR Y FROM INPUT BUFFER
GETCHAR1:
        iny                    ; F25D C8                                        .
; CHECKS CHAR FOR ASCII T, COMPARE TO $1624
IS T?:  jsr     NEXTCHAR       ; F25E 20 9D F3                                   ..
        beq     RTS11          ; F261 F0 41                                     .A
        cmp     #$54           ; F263 C9 54                                     .T
        bne     IS W?          ; F265 D0 18                                     ..
        jsr     SPACELOOP      ; F267 20 9C F3                                   ..
        cmp     $1624          ; F26A CD 24 16                                  .$.
        bne     LF253          ; F26D D0 E4                                     ..
; GET CHAR Y FROM INPUT BUFFER, COMPARE TO $1624
NEXTCHAR2:
        iny                    ; F26F C8                                        .
        lda     (INPUTLB),y    ; F270 B1 E7                                     ..
        beq     RTS11          ; F272 F0 30                                     .0
        cmp     $1624          ; F274 CD 24 16                                  .$.
        beq     GETCHAR1       ; F277 F0 E4                                     ..
        jsr     ATODD          ; F279 20 9A F2                                   ..
        jmp     NEXTCHAR2      ; F27C 4C 6F F2                                  Lo.

; ----------------------------------------------------------------------------
; CHECKS CHAR FOR ASCII W
IS W?:  cmp     #$57           ; F27F C9 57                                     .W
        bne     NOT W          ; F281 D0 11                                     ..
        iny                    ; F283 C8                                        .
        jsr     DO W           ; F284 20 EE FA                                   ..
        lda     $DF            ; F287 A5 DF                                     ..
        jsr     ATODD          ; F289 20 9A F2                                   ..
        lda     $E0            ; F28C A5 E0                                     ..
LF28E:  jsr     ATODD          ; F28E 20 9A F2                                   ..
        jmp     IS T?          ; F291 4C 5E F2                                  L^.

; ----------------------------------------------------------------------------
NOT W:  jsr     LFAD7          ; F294 20 D7 FA                                   ..
        jmp     LF28E          ; F297 4C 8E F2                                  L..

; ----------------------------------------------------------------------------
; returns with ACCUMULATOR IN ($DD)
ATODD:  ldx     #$00           ; F29A A2 00                                     ..
        sta     (DDLO,x)       ; F29C 81 DD                                     ..
        inc     DDLO           ; F29E E6 DD                                     ..
        bne     RTS11          ; F2A0 D0 02                                     ..
        inc     DDHI           ; F2A2 E6 DE                                     ..
RTS11:  rts                    ; F2A4 60                                        `

; ----------------------------------------------------------------------------
LF2A5:  jsr     LF6A5          ; F2A5 20 A5 F6                                   ..
LF2A8:  jsr     LFC5F          ; F2A8 20 5F FC                                   _.
        bcc     LF2CE          ; F2AB 90 21                                     .!
; JSR to T3 to set data table 3
T3SET:  jsr     SETT3          ; F2AD 20 EC F2                                   ..
        ldx     #$DD           ; F2B0 A2 DD                                     ..
        jsr     SPLIT4BITS     ; F2B2 20 E1 F3                                   ..
        ldx     #$10           ; F2B5 A2 10                                     ..
LF2B7:  jsr     SPACENULL      ; F2B7 20 F7 F2                                   ..
        lda     (DDLO),y       ; F2BA B1 DD                                     ..
        jsr     SPLITBITS      ; F2BC 20 EA F3                                   ..
        lda     DDLO           ; F2BF A5 DD                                     ..
        cmp     $DF            ; F2C1 C5 DF                                     ..
        bne     INCDD          ; F2C3 D0 0A                                     ..
        lda     DDHI           ; F2C5 A5 DE                                     ..
        cmp     $E0            ; F2C7 C5 E0                                     ..
        bne     INCDD          ; F2C9 D0 04                                     ..
        jsr     SPACENULL      ; F2CB 20 F7 F2                                   ..
LF2CE:  rts                    ; F2CE 60                                        `

; ----------------------------------------------------------------------------
; INCREMENT ($DD)
INCDD:  inc     DDLO           ; F2CF E6 DD                                     ..
        bne     LF2D5          ; F2D1 D0 02                                     ..
        inc     DDHI           ; F2D3 E6 DE                                     ..
LF2D5:  dex                    ; F2D5 CA                                        .
        bne     LF2B7          ; F2D6 D0 DF                                     ..
        jsr     NULL           ; F2D8 20 FC F2                                   ..
        jsr     LF6A5          ; F2DB 20 A5 F6                                   ..
        jmp     T3SET          ; F2DE 4C AD F2                                  L..

; ----------------------------------------------------------------------------
; SET INPUT BUFFER POINTER TO $BF5D
INPUTPTR:
        lda     #$5D           ; F2E1 A9 5D                                     .]
        sta     INPUTLB        ; F2E3 85 E7                                     ..
        lda     #$BF           ; F2E5 A9 BF                                     ..
        sta     INPUTHB        ; F2E7 85 E8                                     ..
        ldy     #$00           ; F2E9 A0 00                                     ..
        rts                    ; F2EB 60                                        `

; ----------------------------------------------------------------------------
; SET DATA TABLE 3 TO $BFA7
SETT3:  lda     #$A7           ; F2EC A9 A7                                     ..
        sta     T3LB           ; F2EE 85 E9                                     ..
        lda     #$BF           ; F2F0 A9 BF                                     ..
        sta     T3HB           ; F2F2 85 EA                                     ..
        ldy     #$00           ; F2F4 A0 00                                     ..
        rts                    ; F2F6 60                                        `

; ----------------------------------------------------------------------------
; ADD SPACE #$20 AND NULL #$00 TO (T3)
SPACENULL:
        lda     #$20           ; F2F7 A9 20                                     . 
        sta     (T3LB),y       ; F2F9 91 E9                                     ..
        iny                    ; F2FB C8                                        .
; ADD NULL #$00 TO (T3)
NULL:   lda     #$00           ; F2FC A9 00                                     ..
        sta     (T3LB),y       ; F2FE 91 E9                                     ..
        jsr     LF51D          ; F300 20 1D F5                                   ..
        ldy     #$00           ; F303 A0 00                                     ..
        rts                    ; F305 60                                        `

; ----------------------------------------------------------------------------
LF306:  jsr     LF326          ; F306 20 26 F3                                   &.
        ldx     #$04           ; F309 A2 04                                     ..
; CHECKS INPUT AGAINST FSYXA LOWER CASE
FSYXALC:lda     fsyxa,x        ; F30B BD 21 F3                                  .!.
        jsr     LF6AC          ; F30E 20 AC F6                                   ..
        jsr     SETT3          ; F311 20 EC F2                                   ..
        lda     $1670,x        ; F314 BD 70 16                                  .p.
        jsr     SPLITBITS      ; F317 20 EA F3                                   ..
        jsr     SPACENULL      ; F31A 20 F7 F2                                   ..
        dex                    ; F31D CA                                        .
        bpl     FSYXALC        ; F31E 10 EB                                     ..
        rts                    ; F320 60                                        `

; ----------------------------------------------------------------------------
; SEE $F30B
fsyxa:  .byte   $66,$73,$79,$78,$61; F321 66 73 79 78 61                        fsyxa
; ----------------------------------------------------------------------------
LF326:  jsr     LF4F7          ; F326 20 F7 F4                                   ..
        bvs     LF32B          ; F329 70 00                                     p.
LF32B:  lda     $EF            ; F32B A5 EF                                     ..
        sta     DDLO           ; F32D 85 DD                                     ..
        clc                    ; F32F 18                                        .
        adc     #$02           ; F330 69 02                                     i.
        sta     $DF            ; F332 85 DF                                     ..
        ldy     $F0            ; F334 A4 F0                                     ..
        sty     DDHI           ; F336 84 DE                                     ..
        bcc     LF33B          ; F338 90 01                                     ..
        iny                    ; F33A C8                                        .
LF33B:  sty     $E0            ; F33B 84 E0                                     ..
        jmp     LF2A8          ; F33D 4C A8 F2                                  L..

; ----------------------------------------------------------------------------
LF340:  jsr     LF392          ; F340 20 92 F3                                   ..
LF343:  sec                    ; F343 38                                        8
        sbc     #$30           ; F344 E9 30                                     .0
        bmi     LF366          ; F346 30 1E                                     0.
        cmp     #$0A           ; F348 C9 0A                                     ..
        bmi     LF357          ; F34A 30 0B                                     0.
        sec                    ; F34C 38                                        8
        sbc     #$07           ; F34D E9 07                                     ..
        cmp     #$0A           ; F34F C9 0A                                     ..
        bmi     LF366          ; F351 30 13                                     0.
        cmp     #$10           ; F353 C9 10                                     ..
        bpl     LF366          ; F355 10 0F                                     ..
LF357:  jsr     LF3B8          ; F357 20 B8 F3                                   ..
        ora     $00,x          ; F35A 15 00                                     ..
        sta     $00,x          ; F35C 95 00                                     ..
        iny                    ; F35E C8                                        .
        lda     (INPUTLB),y    ; F35F B1 E7                                     ..
        dec     $1644          ; F361 CE 44 16                                  .D.
        bmi     LF343          ; F364 30 DD                                     0.
LF366:  rol     $1644          ; F366 2E 44 16                                  .D.
        jmp     GETCHAR2       ; F369 4C A8 F3                                  L..

; ----------------------------------------------------------------------------
LF36C:  jsr     LF392          ; F36C 20 92 F3                                   ..
        beq     LF366          ; F36F F0 F5                                     ..
LF371:  sec                    ; F371 38                                        8
; INPUT LESS THAN ASCII 0x30
LT30:   sbc     #$30           ; F372 E9 30                                     .0
        bmi     LF366          ; F374 30 F0                                     0.
; ASCII 0x3A = COLON
COLON:  cmp     #$0A           ; F376 C9 0A                                     ..
        bpl     LF366          ; F378 10 EC                                     ..
        jsr     LF3C8          ; F37A 20 C8 F3                                   ..
        adc     $00,x          ; F37D 75 00                                     u.
        sta     $00,x          ; F37F 95 00                                     ..
        lda     $01,x          ; F381 B5 01                                     ..
        adc     #$00           ; F383 69 00                                     i.
        sta     $01,x          ; F385 95 01                                     ..
        bcs     LF3C4          ; F387 B0 3B                                     .;
        dec     $1644          ; F389 CE 44 16                                  .D.
        iny                    ; F38C C8                                        .
        lda     (INPUTLB),y    ; F38D B1 E7                                     ..
        jmp     LF371          ; F38F 4C 71 F3                                  Lq.

; ----------------------------------------------------------------------------
LF392:  lda     #$00           ; F392 A9 00                                     ..
        sta     $00,x          ; F394 95 00                                     ..
        sta     $01,x          ; F396 95 01                                     ..
        sta     $1644          ; F398 8D 44 16                                  .D.
        dey                    ; F39B 88                                        .
; LOOP ON SPACE, RTS ON $161E
SPACELOOP:
        iny                    ; F39C C8                                        .
; GET CHAR Y FROM INPUT BUFFER, COMPARE TO SPACE AND $161E
NEXTCHAR:
        jsr     GETCHAR2       ; F39D 20 A8 F3                                   ..
        beq     RTS7           ; F3A0 F0 04                                     ..
        cmp     #$20           ; F3A2 C9 20                                     . 
        beq     SPACELOOP      ; F3A4 F0 F6                                     ..
RTS7:   rts                    ; F3A6 60                                        `

; ----------------------------------------------------------------------------
        iny                    ; F3A7 C8                                        .
; GET CHAR Y FROM INPUT BUFFER, COMPARE TO NULL AND $161E
GETCHAR2:
        lda     (INPUTLB),y    ; F3A8 B1 E7                                     ..
        beq     RTS8           ; F3AA F0 0B                                     ..
        bcs     LF3B3          ; F3AC B0 05                                     ..
        cmp     $161E          ; F3AE CD 1E 16                                  ...
        clc                    ; F3B1 18                                        .
        rts                    ; F3B2 60                                        `

; ----------------------------------------------------------------------------
LF3B3:  cmp     $161E          ; F3B3 CD 1E 16                                  ...
        sec                    ; F3B6 38                                        8
RTS8:   rts                    ; F3B7 60                                        `

; ----------------------------------------------------------------------------
LF3B8:  jsr     LF3BB          ; F3B8 20 BB F3                                   ..
LF3BB:  jsr     LF3BE          ; F3BB 20 BE F3                                   ..
LF3BE:  asl     $00,x          ; F3BE 16 00                                     ..
        rol     $01,x          ; F3C0 36 01                                     6.
        bcc     RTS3           ; F3C2 90 03                                     ..
LF3C4:  jmp     (L160E)        ; F3C4 6C 0E 16                                  l..

; ----------------------------------------------------------------------------
RTS3:   rts                    ; F3C7 60                                        `

; ----------------------------------------------------------------------------
LF3C8:  jsr     LF3BE          ; F3C8 20 BE F3                                   ..
        pha                    ; F3CB 48                                        H
        lda     $01,x          ; F3CC B5 01                                     ..
        pha                    ; F3CE 48                                        H
        lda     $00,x          ; F3CF B5 00                                     ..
        jsr     LF3BB          ; F3D1 20 BB F3                                   ..
        adc     $00,x          ; F3D4 75 00                                     u.
        sta     $00,x          ; F3D6 95 00                                     ..
        pla                    ; F3D8 68                                        h
        adc     $01,x          ; F3D9 75 01                                     u.
        sta     $01,x          ; F3DB 95 01                                     ..
        pla                    ; F3DD 68                                        h
        bcs     LF3C4          ; F3DE B0 E4                                     ..
        rts                    ; F3E0 60                                        `

; ----------------------------------------------------------------------------
; returns with $E9 with top 4 bits of $DE, $EA with lower 4; $EB,$EC with hi/lo 4 bits of $DD;
SPLIT4BITS:
        ldy     #$00           ; F3E1 A0 00                                     ..
        lda     $01,x          ; F3E3 B5 01                                     ..
        jsr     SPLITBITS      ; F3E5 20 EA F3                                   ..
        lda     $00,x          ; F3E8 B5 00                                     ..
; SPLITS A INTO TOP AND BOTTOM 4 BITS, STORES AT $E9/$EA, $EB/$EC
SPLITBITS:
        pha                    ; F3EA 48                                        H
        lsr     a              ; F3EB 4A                                        J
        lsr     a              ; F3EC 4A                                        J
        lsr     a              ; F3ED 4A                                        J
        lsr     a              ; F3EE 4A                                        J
        jsr     LF3F3          ; F3EF 20 F3 F3                                   ..
        pla                    ; F3F2 68                                        h
LF3F3:  and     #$0F           ; F3F3 29 0F                                     ).
        clc                    ; F3F5 18                                        .
        adc     #$30           ; F3F6 69 30                                     i0
        cmp     #$3A           ; F3F8 C9 3A                                     .:
        bmi     LF3FE          ; F3FA 30 02                                     0.
        adc     #$06           ; F3FC 69 06                                     i.
LF3FE:  sta     (T3LB),y       ; F3FE 91 E9                                     ..
        iny                    ; F400 C8                                        .
        rts                    ; F401 60                                        `

; ----------------------------------------------------------------------------
LF402:  lda     $1627          ; F402 AD 27 16                                  .'.
        bne     LF40D          ; F405 D0 06                                     ..
LF407:  lda     $BF5B          ; F407 AD 5B BF                                  .[.
        bpl     LF407          ; F40A 10 FB                                     ..
        rts                    ; F40C 60                                        `

; ----------------------------------------------------------------------------
LF40D:  lda     #$40           ; F40D A9 40                                     .@
LF40F:  sta     $FA            ; F40F 85 FA                                     ..
        jsr     LF8EB          ; F411 20 EB F8                                   ..
        jsr     LF88A          ; F414 20 8A F8                                   ..
        ldx     #$04           ; F417 A2 04                                     ..
LF419:  jsr     LF887          ; F419 20 87 F8                                   ..
        dex                    ; F41C CA                                        .
        bpl     LF419          ; F41D 10 FA                                     ..
        ldy     $1627          ; F41F AC 27 16                                  .'.
        ldx     #$C8           ; F422 A2 C8                                     ..
LF424:  lda     $BF5B          ; F424 AD 5B BF                                  .[.
        bmi     LF436          ; F427 30 0D                                     0.
        dex                    ; F429 CA                                        .
        bne     LF424          ; F42A D0 F8                                     ..
        dey                    ; F42C 88                                        .
        bne     LF424          ; F42D D0 F5                                     ..
LF42F:  lda     $FA            ; F42F A5 FA                                     ..
        eor     #$40           ; F431 49 40                                     I@
        jmp     LF40F          ; F433 4C 0F F4                                  L..

; ----------------------------------------------------------------------------
LF436:  bit     a:$FA          ; F436 2C FA 00                                  ,..
        bvs     LF42F          ; F439 70 F4                                     p.
        rts                    ; F43B 60                                        `

; ----------------------------------------------------------------------------
        pha                    ; F43C 48                                        H
        lda     6530PADD       ; F43D AD 01 17                                  ...
        and     #$80           ; F440 29 80                                     ).
        sta     6530PADD       ; F442 8D 01 17                                  ...
        lda     6530IO         ; F445 AD 00 17                                  ...
        ora     #$80           ; F448 09 80                                     ..
        cmp     #$83           ; F44A C9 83                                     ..
        bne     LF452          ; F44C D0 04                                     ..
        pla                    ; F44E 68                                        h
        jmp     (JUMP TABLE)   ; F44F 6C 00 16                                  l..

; ----------------------------------------------------------------------------
LF452:  cmp     #$84           ; F452 C9 84                                     ..
        bne     LF45A          ; F454 D0 04                                     ..
        pla                    ; F456 68                                        h
        jmp     (L1602)        ; F457 6C 02 16                                  l..

; ----------------------------------------------------------------------------
LF45A:  cmp     $161F          ; F45A CD 1F 16                                  ...
        bne     LF463          ; F45D D0 04                                     ..
        pla                    ; F45F 68                                        h
        jmp     (L1604)        ; F460 6C 04 16                                  l..

; ----------------------------------------------------------------------------
LF463:  sta     $BF5B          ; F463 8D 5B BF                                  .[.
        pla                    ; F466 68                                        h
        rti                    ; F467 40                                        @

; ----------------------------------------------------------------------------
LF468:  lda     #$7F           ; F468 A9 7F                                     ..
        sta     $BF5B          ; F46A 8D 5B BF                                  .[.
LF46D:  stx     XTMP2          ; F46D 8E 4B BF                                  .K.
        sty     YTMP2          ; F470 8C 4C BF                                  .L.
        bit     $1640          ; F473 2C 40 16                                  ,@.
        bpl     LF47B          ; F476 10 03                                     ..
        jmp     (L1606)        ; F478 6C 06 16                                  l..

; ----------------------------------------------------------------------------
LF47B:  jsr     LF402          ; F47B 20 02 F4                                   ..
        and     #$7F           ; F47E 29 7F                                     ).
        sta     $BF5B          ; F480 8D 5B BF                                  .[.
        cmp     #$19           ; F483 C9 19                                     ..
        bne     LF492          ; F485 D0 0B                                     ..
        lda     $163A          ; F487 AD 3A 16                                  .:.
        eor     #$40           ; F48A 49 40                                     I@
        sta     $163A          ; F48C 8D 3A 16                                  .:.
        jmp     LF46D          ; F48F 4C 6D F4                                  Lm.

; ----------------------------------------------------------------------------
LF492:  cmp     #$7F           ; F492 C9 7F                                     ..
        bne     LF498          ; F494 D0 02                                     ..
        lda     #$08           ; F496 A9 08                                     ..
LF498:  bit     $163A          ; F498 2C 3A 16                                  ,:.
        bvc     LF4A0          ; F49B 50 03                                     P.
        jsr     LOWERCASE      ; F49D 20 C2 F4                                   ..
LF4A0:  bmi     LF4B7          ; F4A0 30 15                                     0.
        pha                    ; F4A2 48                                        H
        jsr     LF6AC          ; F4A3 20 AC F6                                   ..
        pla                    ; F4A6 68                                        h
        cmp     #$0D           ; F4A7 C9 0D                                     ..
        bne     LF4B7          ; F4A9 D0 0C                                     ..
        pha                    ; F4AB 48                                        H
        bit     $163C          ; F4AC 2C 3C 16                                  ,<.
        bmi     LF4B6          ; F4AF 30 05                                     0.
        lda     #$0A           ; F4B1 A9 0A                                     ..
        jsr     LF6AC          ; F4B3 20 AC F6                                   ..
LF4B6:  pla                    ; F4B6 68                                        h
LF4B7:  cmp     #$0C           ; F4B7 C9 0C                                     ..
        beq     LF47B          ; F4B9 F0 C0                                     ..
        ldx     XTMP2          ; F4BB AE 4B BF                                  .K.
        ldy     YTMP2          ; F4BE AC 4C BF                                  .L.
        rts                    ; F4C1 60                                        `

; ----------------------------------------------------------------------------
; CHARACTER IS LOWER CASE - BETWEEN A $61 AND { $7B
LOWERCASE:
        php                    ; F4C2 08                                        .
        cmp     #$61           ; F4C3 C9 61                                     .a
        bmi     LF4CE          ; F4C5 30 07                                     0.
        cmp     #$7B           ; F4C7 C9 7B                                     .{
        bpl     LF4CE          ; F4C9 10 03                                     ..
        sec                    ; F4CB 38                                        8
        sbc     #$20           ; F4CC E9 20                                     . 
LF4CE:  plp                    ; F4CE 28                                        (
        rts                    ; F4CF 60                                        `

; ----------------------------------------------------------------------------
LF4D0:  ldy     #$00           ; F4D0 A0 00                                     ..
LF4D2:  jsr     LF468          ; F4D2 20 68 F4                                   h.
        cmp     #$08           ; F4D5 C9 08                                     ..
        bne     CAN/CR         ; F4D7 D0 07                                     ..
        tya                    ; F4D9 98                                        .
        beq     LF4D2          ; F4DA F0 F6                                     ..
        dey                    ; F4DC 88                                        .
        jmp     LF4D2          ; F4DD 4C D2 F4                                  L..

; ----------------------------------------------------------------------------
; CHECKS FOR CANCEL/CR?
CAN/CR: cmp     #$18           ; F4E0 C9 18                                     ..
        beq     LF4D0          ; F4E2 F0 EC                                     ..
        cmp     #$0D           ; F4E4 C9 0D                                     ..
        beq     LF4F0          ; F4E6 F0 08                                     ..
        sta     (INPUTLB),y    ; F4E8 91 E7                                     ..
        iny                    ; F4EA C8                                        .
        cpy     $1629          ; F4EB CC 29 16                                  .).
        bne     LF4D2          ; F4EE D0 E2                                     ..
LF4F0:  lda     #$00           ; F4F0 A9 00                                     ..
        sta     (INPUTLB),y    ; F4F2 91 E7                                     ..
        ldy     #$00           ; F4F4 A0 00                                     ..
        rts                    ; F4F6 60                                        `

; ----------------------------------------------------------------------------
LF4F7:  jsr     LF6A5          ; F4F7 20 A5 F6                                   ..
        pla                    ; F4FA 68                                        h
        sta     T3LB           ; F4FB 85 E9                                     ..
        pla                    ; F4FD 68                                        h
        sta     T3HB           ; F4FE 85 EA                                     ..
        inc     T3LB           ; F500 E6 E9                                     ..
        bne     LF506          ; F502 D0 02                                     ..
        inc     T3HB           ; F504 E6 EA                                     ..
LF506:  tya                    ; F506 98                                        .
        jsr     LF51D          ; F507 20 1D F5                                   ..
        pha                    ; F50A 48                                        H
        tya                    ; F50B 98                                        .
        clc                    ; F50C 18                                        .
        adc     T3LB           ; F50D 65 E9                                     e.
        sta     T3LB           ; F50F 85 E9                                     ..
        bcc     LF515          ; F511 90 02                                     ..
        inc     T3HB           ; F513 E6 EA                                     ..
LF515:  pla                    ; F515 68                                        h
        tay                    ; F516 A8                                        .
        jmp     (T3LB)         ; F517 6C E9 00                                  l..

; ----------------------------------------------------------------------------
        jsr     LF6A5          ; F51A 20 A5 F6                                   ..
LF51D:  ldy     #$00           ; F51D A0 00                                     ..
        pha                    ; F51F 48                                        H
LF520:  lda     (T3LB),y       ; F520 B1 E9                                     ..
        beq     LF52E          ; F522 F0 0A                                     ..
        jsr     LF6AC          ; F524 20 AC F6                                   ..
        iny                    ; F527 C8                                        .
        bne     LF520          ; F528 D0 F6                                     ..
        inc     T3HB           ; F52A E6 EA                                     ..
        bne     LF520          ; F52C D0 F2                                     ..
LF52E:  iny                    ; F52E C8                                        .
        pla                    ; F52F 68                                        h
        rts                    ; F530 60                                        `

; ----------------------------------------------------------------------------
        cmp     #$B3           ; F531 C9 B3                                     ..
        bcc     LF537          ; F533 90 02                                     ..
        lda     #$B3           ; F535 A9 B3                                     ..
LF537:  sta     $162C          ; F537 8D 2C 16                                  .,.
        ldx     #$C7           ; F53A A2 C7                                     ..
        stx     $162B          ; F53C 8E 2B 16                                  .+.
        jsr     LF92E          ; F53F 20 2E F9                                   ..
        sta     $1630          ; F542 8D 30 16                                  .0.
        clc                    ; F545 18                                        .
        adc     #$27           ; F546 69 27                                     i'
        sta     $1632          ; F548 8D 32 16                                  .2.
        lda     SCRNHI         ; F54B A5 FC                                     ..
        sta     $1631          ; F54D 8D 31 16                                  .1.
        adc     #$A0           ; F550 69 A0                                     i.
        sta     6530APIO       ; F552 8D 33 17                                  .3.
LF555:  tya                    ; F555 98                                        .
        sec                    ; F556 38                                        8
        sbc     #$14           ; F557 E9 14                                     ..
        cmp     $162C          ; F559 CD 2C 16                                  .,.
        bcs     LF561          ; F55C B0 03                                     ..
        iny                    ; F55E C8                                        .
        bcc     LF555          ; F55F 90 F4                                     ..
LF561:  tya                    ; F561 98                                        .
        cmp     #$C8           ; F562 C9 C8                                     ..
        bcc     LF568          ; F564 90 02                                     ..
        lda     #$C7           ; F566 A9 C7                                     ..
LF568:  sta     $162D          ; F568 8D 2D 16                                  .-.
        jsr     LF92E          ; F56B 20 2E F9                                   ..
        sta     $1634          ; F56E 8D 34 16                                  .4.
        lda     SCRNHI         ; F571 A5 FC                                     ..
        clc                    ; F573 18                                        .
        adc     #$A0           ; F574 69 A0                                     i.
        sta     $1635          ; F576 8D 35 16                                  .5.
        ldx     #$00           ; F579 A2 00                                     ..
        stx     $ED            ; F57B 86 ED                                     ..
        stx     $EE            ; F57D 86 EE                                     ..
        ldy     $162D          ; F57F AC 2D 16                                  .-.
        iny                    ; F582 C8                                        .
        stx     $162E          ; F583 8E 2E 16                                  ...
        cpy     $162C          ; F586 CC 2C 16                                  .,.
        bcs     LF58E          ; F589 B0 03                                     ..
        ldy     $162C          ; F58B AC 2C 16                                  .,.
LF58E:  cpy     #$C8           ; F58E C0 C8                                     ..
        bcc     LF594          ; F590 90 02                                     ..
        ldy     #$C7           ; F592 A0 C7                                     ..
LF594:  sty     $162F          ; F594 8C 2F 16                                  ./.
        lda     #$C7           ; F597 A9 C7                                     ..
        sec                    ; F599 38                                        8
        sbc     $162F          ; F59A ED 2F 16                                  ./.
        sta     $162B          ; F59D 8D 2B 16                                  .+.
        lda     #$FF           ; F5A0 A9 FF                                     ..
        cpx     #$41           ; F5A2 E0 41                                     .A
        bcc     LF5B3          ; F5A4 90 0D                                     ..
        txa                    ; F5A6 8A                                        .
        sec                    ; F5A7 38                                        8
        sbc     #$40           ; F5A8 E9 40                                     .@
        sta     $162A          ; F5AA 8D 2A 16                                  .*.
        lda     #$FF           ; F5AD A9 FF                                     ..
        sec                    ; F5AF 38                                        8
        sbc     $162A          ; F5B0 ED 2A 16                                  .*.
LF5B3:  sta     $162A          ; F5B3 8D 2A 16                                  .*.
        ldx     #$00           ; F5B6 A2 00                                     ..
        stx     $EB            ; F5B8 86 EB                                     ..
        stx     $EC            ; F5BA 86 EC                                     ..
        rts                    ; F5BC 60                                        `

; ----------------------------------------------------------------------------
DO CANCEL:
        jsr     DOCR           ; F5BD 20 5A F6                                   Z.
DO LFEED:
        bit     $1639          ; F5C0 2C 39 16                                  ,9.
        bmi     LF5D2          ; F5C3 30 0D                                     0.
        lda     $EC            ; F5C5 A5 EC                                     ..
        sec                    ; F5C7 38                                        8
        sbc     #$0A           ; F5C8 E9 0A                                     ..
        sta     $EC            ; F5CA 85 EC                                     ..
        rts                    ; F5CC 60                                        `

; ----------------------------------------------------------------------------
        brk                    ; F5CD 00                                        .
        brk                    ; F5CE 00                                        .
        brk                    ; F5CF 00                                        .
        brk                    ; F5D0 00                                        .
        brk                    ; F5D1 00                                        .
LF5D2:  lda     $1634          ; F5D2 AD 34 16                                  .4.
        sta     SCRNLO         ; F5D5 85 FB                                     ..
        clc                    ; F5D7 18                                        .
        adc     #$90           ; F5D8 69 90                                     i.
        sta     CHARLO         ; F5DA 85 F1                                     ..
        lda     $1635          ; F5DC AD 35 16                                  .5.
        sta     SCRNHI         ; F5DF 85 FC                                     ..
        adc     #$01           ; F5E1 69 01                                     i.
        sta     CHARHI         ; F5E3 85 F2                                     ..
        lda     $1632          ; F5E5 AD 32 16                                  .2.
        sec                    ; F5E8 38                                        8
        sbc     CHARLO         ; F5E9 E5 F1                                     ..
        sta     $1636          ; F5EB 8D 36 16                                  .6.
        lda     $1633          ; F5EE AD 33 16                                  .3.
        sbc     CHARHI         ; F5F1 E5 F2                                     ..
        tax                    ; F5F3 AA                                        .
        ldy     #$00           ; F5F4 A0 00                                     ..
LF5F6:  lda     (CHARLO),y     ; F5F6 B1 F1                                     ..
        sta     (SCRNLO),y     ; F5F8 91 FB                                     ..
        iny                    ; F5FA C8                                        .
        bne     LF5F6          ; F5FB D0 F9                                     ..
        inc     SCRNHI         ; F5FD E6 FC                                     ..
        inc     CHARHI         ; F5FF E6 F2                                     ..
        dex                    ; F601 CA                                        .
        bne     LF5F6          ; F602 D0 F2                                     ..
        beq     LF607          ; F604 F0 01                                     ..
LF606:  iny                    ; F606 C8                                        .
LF607:  lda     (CHARLO),y     ; F607 B1 F1                                     ..
        sta     (SCRNLO),y     ; F609 91 FB                                     ..
        cpy     $1636          ; F60B CC 36 16                                  .6.
        bne     LF606          ; F60E D0 F6                                     ..
        txa                    ; F610 8A                                        .
        jsr     LF620          ; F611 20 20 F6                                    .
        ldx     #$90           ; F614 A2 90                                     ..
        jsr     LF620          ; F616 20 20 F6                                    .
        ldx     XTMP1          ; F619 AE 49 BF                                  .I.
        ldy     YTMP1          ; F61C AC 4A BF                                  .J.
        rts                    ; F61F 60                                        `

; ----------------------------------------------------------------------------
LF620:  iny                    ; F620 C8                                        .
        bne     LF625          ; F621 D0 02                                     ..
        inc     SCRNHI         ; F623 E6 FC                                     ..
LF625:  sta     (SCRNLO),y     ; F625 91 FB                                     ..
        dex                    ; F627 CA                                        .
        bne     LF620          ; F628 D0 F6                                     ..
        rts                    ; F62A 60                                        `

; ----------------------------------------------------------------------------
; CHECKS FOR ASCII TAB
TAB:    cmp     #$09           ; F62B C9 09                                     ..
        bne     FFEED          ; F62D D0 6B                                     .k
DO TAB: bit     $1639          ; F62F 2C 39 16                                  ,9.
        bmi     LF63C          ; F632 30 08                                     0.
        clc                    ; F634 18                                        .
        lda     $EB            ; F635 A5 EB                                     ..
        adc     #$06           ; F637 69 06                                     i.
        sta     $EB            ; F639 85 EB                                     ..
        rts                    ; F63B 60                                        `

; ----------------------------------------------------------------------------
LF63C:  lda     $ED            ; F63C A5 ED                                     ..
        clc                    ; F63E 18                                        .
        adc     #$06           ; F63F 69 06                                     i.
        sta     $ED            ; F641 85 ED                                     ..
        bcc     LF647          ; F643 90 02                                     ..
        inc     $EE            ; F645 E6 EE                                     ..
LF647:  sec                    ; F647 38                                        8
        sbc     #$3B           ; F648 E9 3B                                     .;
        lda     $EE            ; F64A A5 EE                                     ..
        sbc     #$01           ; F64C E9 01                                     ..
        bcc     RTS2           ; F64E 90 03                                     ..
        jmp     DO CANCEL      ; F650 4C BD F5                                  L..

; ----------------------------------------------------------------------------
RTS2:   rts                    ; F653 60                                        `

; ----------------------------------------------------------------------------
; CHECKS FOR ASCII CARRIAGE RETURN
CR:     adc     #$20           ; F654 69 20                                     i 
        cmp     #$0D           ; F656 C9 0D                                     ..
        bne     BACKSPACE      ; F658 D0 1D                                     ..
DOCR:   lda     #$00           ; F65A A9 00                                     ..
        bit     $1639          ; F65C 2C 39 16                                  ,9.
        bmi     EDEEto00       ; F65F 30 03                                     0.
        sta     $EB            ; F661 85 EB                                     ..
        rts                    ; F663 60                                        `

; ----------------------------------------------------------------------------
; returns with $ED EE->#$00.
EDEEto00:
        sta     $ED            ; F664 85 ED                                     ..
        sta     $EE            ; F666 85 EE                                     ..
RTS1:   rts                    ; F668 60                                        `

; ----------------------------------------------------------------------------
; CHECKS FOR ASCII LINEFEED
LFEED:  cmp     #$0A           ; F669 C9 0A                                     ..
        bne     CANCEL         ; F66B D0 03                                     ..
        jmp     DO LFEED       ; F66D 4C C0 F5                                  L..

; ----------------------------------------------------------------------------
; CHECKS FOR ASCII CANCEL
CANCEL: cmp     #$18           ; F670 C9 18                                     ..
        bne     RTS1           ; F672 D0 F4                                     ..
        jmp     DO CANCEL      ; F674 4C BD F5                                  L..

; ----------------------------------------------------------------------------
; CHECKS FOR ASCII BACKSPACE
BACKSPACE:
        cmp     #$08           ; F677 C9 08                                     ..
        bne     TAB            ; F679 D0 B0                                     ..
        bit     $1639          ; F67B 2C 39 16                                  ,9.
        bmi     LF68A          ; F67E 30 0A                                     0.
        lda     $EB            ; F680 A5 EB                                     ..
        sec                    ; F682 38                                        8
        sbc     #$06           ; F683 E9 06                                     ..
        bcc     DOCR           ; F685 90 D3                                     ..
        sta     $EB            ; F687 85 EB                                     ..
        rts                    ; F689 60                                        `

; ----------------------------------------------------------------------------
LF68A:  lda     $ED            ; F68A A5 ED                                     ..
        sec                    ; F68C 38                                        8
        sbc     #$06           ; F68D E9 06                                     ..
        sta     $ED            ; F68F 85 ED                                     ..
        lda     $EE            ; F691 A5 EE                                     ..
        sbc     #$00           ; F693 E9 00                                     ..
        bcc     DOCR           ; F695 90 C3                                     ..
        sta     $EE            ; F697 85 EE                                     ..
        rts                    ; F699 60                                        `

; ----------------------------------------------------------------------------
; CHECKS FOR ASCII FORM FEED
FFEED:  cmp     #$0C           ; F69A C9 0C                                     ..
        bne     LFEED          ; F69C D0 CB                                     ..
        jsr     DO FFEED       ; F69E 20 56 F9                                   V.
        jsr     DOCR           ; F6A1 20 5A F6                                   Z.
        rts                    ; F6A4 60                                        `

; ----------------------------------------------------------------------------
LF6A5:  lda     #$0D           ; F6A5 A9 0D                                     ..
        jsr     LF6AC          ; F6A7 20 AC F6                                   ..
        lda     #$0A           ; F6AA A9 0A                                     ..
LF6AC:  bit     $1640          ; F6AC 2C 40 16                                  ,@.
        bvc     LF6B4          ; F6AF 50 03                                     P.
        jmp     (L1608)        ; F6B1 6C 08 16                                  l..

; ----------------------------------------------------------------------------
LF6B4:  stx     XTMP1          ; F6B4 8E 49 BF                                  .I.
        sty     YTMP1          ; F6B7 8C 4A BF                                  .J.
        and     #$7F           ; F6BA 29 7F                                     ).
        sec                    ; F6BC 38                                        8
        sbc     #$20           ; F6BD E9 20                                     . 
        bcc     CR             ; F6BF 90 93                                     ..
        sta     $F7            ; F6C1 85 F7                                     ..
        jsr     LF8EB          ; F6C3 20 EB F8                                   ..
        lda     $F7            ; F6C6 A5 F7                                     ..
        sta     CHARLO         ; F6C8 85 F1                                     ..
        ldy     #$F0           ; F6CA A0 F0                                     ..
        asl     a              ; F6CC 0A                                        .
        asl     a              ; F6CD 0A                                        .
        bcc     LF6D2          ; F6CE 90 02                                     ..
        iny                    ; F6D0 C8                                        .
        clc                    ; F6D1 18                                        .
LF6D2:  adc     CHARLO         ; F6D2 65 F1                                     e.
        sta     CHARLO         ; F6D4 85 F1                                     ..
        bcc     LF6D9          ; F6D6 90 01                                     ..
        iny                    ; F6D8 C8                                        .
LF6D9:  sty     CHARHI         ; F6D9 84 F2                                     ..
        ldy     #$00           ; F6DB A0 00                                     ..
        sty     $FA            ; F6DD 84 FA                                     ..
        lda     (CHARLO),y     ; F6DF B1 F1                                     ..
        sta     $F4            ; F6E1 85 F4                                     ..
        bmi     DISPLAYCHAR    ; F6E3 30 0C                                     0.
        sty     $F5            ; F6E5 84 F5                                     ..
        sty     $F6            ; F6E7 84 F6                                     ..
        jsr     MASKCHAR1      ; F6E9 20 15 F7                                   ..
        jsr     MASKCHAR1      ; F6EC 20 15 F7                                   ..
        sty     $FA            ; F6EF 84 FA                                     ..
; CHARACTER BYTES TO BITMAPS FOR DISPLAY
DISPLAYCHAR:
        jsr     CHARTOBITMAP   ; F6F1 20 49 F7                                   I.
        jsr     MASKCHAR1      ; F6F4 20 15 F7                                   ..
        lda     $FA            ; F6F7 A5 FA                                     ..
        cmp     #$07           ; F6F9 C9 07                                     ..
        bmi     DISPLAYCHAR    ; F6FB 30 F4                                     0.
        bit     $F4            ; F6FD 24 F4                                     $.
        bpl     LF70B          ; F6FF 10 0A                                     ..
        sty     $F5            ; F701 84 F5                                     ..
        sty     $F6            ; F703 84 F6                                     ..
        jsr     MASKCHAR1      ; F705 20 15 F7                                   ..
        jsr     MASKCHAR1      ; F708 20 15 F7                                   ..
LF70B:  jsr     DO TAB         ; F70B 20 2F F6                                   /.
        ldy     YTMP1          ; F70E AC 4A BF                                  .J.
        ldx     XTMP1          ; F711 AE 49 BF                                  .I.
        rts                    ; F714 60                                        `

; ----------------------------------------------------------------------------
; MASKS CHAR WITH MASK1/2
MASKCHAR1:
        ldy     #$00           ; F715 A0 00                                     ..
        ldx     $FD            ; F717 A6 FD                                     ..
        lda     MASK1,x        ; F719 BD 39 F7                                  .9.
        and     (SCRNLO),y     ; F71C 31 FB                                     1.
        ora     $F5            ; F71E 05 F5                                     ..
        sta     (SCRNLO),y     ; F720 91 FB                                     ..
        lda     MASK2,x        ; F722 BD 41 F7                                  .A.
        iny                    ; F725 C8                                        .
        and     (SCRNLO),y     ; F726 31 FB                                     1.
        ora     $F6            ; F728 05 F6                                     ..
        sta     (SCRNLO),y     ; F72A 91 FB                                     ..
        lda     SCRNLO         ; F72C A5 FB                                     ..
        sec                    ; F72E 38                                        8
        sbc     #$28           ; F72F E9 28                                     .(
        sta     SCRNLO         ; F731 85 FB                                     ..
        bcs     LF737          ; F733 B0 02                                     ..
        dec     SCRNHI         ; F735 C6 FC                                     ..
LF737:  dey                    ; F737 88                                        .
        rts                    ; F738 60                                        `

; ----------------------------------------------------------------------------
; BIT MASK TABLE
MASK1:  .byte   $03,$81,$C0,$E0,$F0,$F8,$FC,$FE; F739 03 81 C0 E0 F0 F8 FC FE   ........
; BIT MASK TABLE
MASK2:  .byte   $FF,$FF,$FF,$7F,$3F,$1F,$0F,$07; F741 FF FF FF 7F 3F 1F 0F 07   ....?...
; ----------------------------------------------------------------------------
; CHARACTER BYTES TO BITMAPS FOR DISPLAY
CHARTOBITMAP:
        ldx     #$00           ; F749 A2 00                                     ..
        stx     $F6            ; F74B 86 F6                                     ..
        ldy     $FA            ; F74D A4 FA                                     ..
        cpy     #$05           ; F74F C0 05                                     ..
        bpl     LF775          ; F751 10 22                                     ."
        lda     (CHARLO),y     ; F753 B1 F1                                     ..
        and     #$1F           ; F755 29 1F                                     ).
LF757:  ldx     $FD            ; F757 A6 FD                                     ..
        cpx     #$03           ; F759 E0 03                                     ..
        beq     LF768          ; F75B F0 0B                                     ..
        bmi     LF76D          ; F75D 30 0E                                     0.
        dex                    ; F75F CA                                        .
        dex                    ; F760 CA                                        .
        dex                    ; F761 CA                                        .
LF762:  lsr     a              ; F762 4A                                        J
        ror     $F6            ; F763 66 F6                                     f.
        dex                    ; F765 CA                                        .
        bne     LF762          ; F766 D0 FA                                     ..
LF768:  sta     $F5            ; F768 85 F5                                     ..
        inc     $FA            ; F76A E6 FA                                     ..
        rts                    ; F76C 60                                        `

; ----------------------------------------------------------------------------
LF76D:  asl     a              ; F76D 0A                                        .
        cpx     #$02           ; F76E E0 02                                     ..
        beq     LF768          ; F770 F0 F6                                     ..
        inx                    ; F772 E8                                        .
        bne     LF76D          ; F773 D0 F8                                     ..
LF775:  lda     #$01           ; F775 A9 01                                     ..
        cpy     #$05           ; F777 C0 05                                     ..
        beq     LF77D          ; F779 F0 02                                     ..
        lda     #$03           ; F77B A9 03                                     ..
LF77D:  tay                    ; F77D A8                                        .
        lda     (CHARLO),y     ; F77E B1 F1                                     ..
        lsr     a              ; F780 4A                                        J
        lsr     a              ; F781 4A                                        J
        lsr     a              ; F782 4A                                        J
        and     #$1C           ; F783 29 1C                                     ).
        sta     $F7            ; F785 85 F7                                     ..
        iny                    ; F787 C8                                        .
        lda     (CHARLO),y     ; F788 B1 F1                                     ..
        rol     a              ; F78A 2A                                        *
        rol     a              ; F78B 2A                                        *
        rol     a              ; F78C 2A                                        *
        and     #$03           ; F78D 29 03                                     ).
        ora     $F7            ; F78F 05 F7                                     ..
        jmp     LF757          ; F791 4C 57 F7                                  LW.

; ----------------------------------------------------------------------------
LF794:  jsr     LF8B6          ; F794 20 B6 F8                                   ..
        lsr     $F9            ; F797 46 F9                                     F.
        tax                    ; F799 AA                                        .
        beq     LF7A6          ; F79A F0 0A                                     ..
        bit     $F9            ; F79C 24 F9                                     $.
        bvc     DOWNLOOP       ; F79E 50 09                                     P.
UPLOOP: jsr     GO UP          ; F7A0 20 AA F8                                   ..
        dex                    ; F7A3 CA                                        .
        bne     UPLOOP         ; F7A4 D0 FA                                     ..
LF7A6:  jmp     LF813          ; F7A6 4C 13 F8                                  L..

; ----------------------------------------------------------------------------
DOWNLOOP:
        jsr     GO DOWN        ; F7A9 20 B0 F8                                   ..
        dex                    ; F7AC CA                                        .
        bne     DOWNLOOP       ; F7AD D0 FA                                     ..
        jmp     LF813          ; F7AF 4C 13 F8                                  L..

; ----------------------------------------------------------------------------
LF7B2:  ldx     $F5            ; F7B2 A6 F5                                     ..
LF7B4:  jsr     LF887          ; F7B4 20 87 F8                                   ..
        dex                    ; F7B7 CA                                        .
        bne     LF7B4          ; F7B8 D0 FA                                     ..
        jmp     LF813          ; F7BA 4C 13 F8                                  L..

; ----------------------------------------------------------------------------
        clc                    ; F7BD 18                                        .
        bcc     LF7C1          ; F7BE 90 01                                     ..
        sec                    ; F7C0 38                                        8
LF7C1:  sta     $BF48          ; F7C1 8D 48 BF                                  .H.
        ror     $FA            ; F7C4 66 FA                                     f.
        stx     $F3            ; F7C6 86 F3                                     ..
        sty     $F4            ; F7C8 84 F4                                     ..
        lda     $F3            ; F7CA A5 F3                                     ..
        sec                    ; F7CC 38                                        8
        sbc     $EB            ; F7CD E5 EB                                     ..
        sta     $F5            ; F7CF 85 F5                                     ..
        ror     $FA            ; F7D1 66 FA                                     f.
        bmi     LF7DD          ; F7D3 30 08                                     0.
        jsr     SWAP EBF3      ; F7D5 20 4D F8                                   M.
        sec                    ; F7D8 38                                        8
        sbc     $EB            ; F7D9 E5 EB                                     ..
        sta     $F5            ; F7DB 85 F5                                     ..
LF7DD:  lda     $F5            ; F7DD A5 F5                                     ..
        beq     LF794          ; F7DF F0 B3                                     ..
        jsr     LF8B6          ; F7E1 20 B6 F8                                   ..
        beq     LF7B2          ; F7E4 F0 CC                                     ..
        cmp     $F5            ; F7E6 C5 F5                                     ..
        bcc     LF7F0          ; F7E8 90 06                                     ..
        ldy     $F5            ; F7EA A4 F5                                     ..
        sta     $F5            ; F7EC 85 F5                                     ..
        sty     $F6            ; F7EE 84 F6                                     ..
LF7F0:  ror     $F9            ; F7F0 66 F9                                     f.
        lda     $F5            ; F7F2 A5 F5                                     ..
        tax                    ; F7F4 AA                                        .
        sec                    ; F7F5 38                                        8
        sbc     $F6            ; F7F6 E5 F6                                     ..
        sta     $F5            ; F7F8 85 F5                                     ..
        txa                    ; F7FA 8A                                        .
        lsr     a              ; F7FB 4A                                        J
        sta     $F7            ; F7FC 85 F7                                     ..
LF7FE:  lda     $F7            ; F7FE A5 F7                                     ..
        sec                    ; F800 38                                        8
        sbc     $F6            ; F801 E5 F6                                     ..
        beq     LF830          ; F803 F0 2B                                     .+
        bcc     LF831          ; F805 90 2A                                     .*
        sta     $F7            ; F807 85 F7                                     ..
        bit     $F9            ; F809 24 F9                                     $.
        bmi     LF822          ; F80B 30 15                                     0.
        jsr     LF887          ; F80D 20 87 F8                                   ..
LF810:  dex                    ; F810 CA                                        .
        bne     LF7FE          ; F811 D0 EB                                     ..
LF813:  bit     $FA            ; F813 24 FA                                     $.
        bpl     LF81A          ; F815 10 03                                     ..
        jsr     SWAP EBF3      ; F817 20 4D F8                                   M.
LF81A:  ldx     $EB            ; F81A A6 EB                                     ..
        ldy     $EC            ; F81C A4 EC                                     ..
        lda     $BF48          ; F81E AD 48 BF                                  .H.
        rts                    ; F821 60                                        `

; ----------------------------------------------------------------------------
LF822:  bvc     LF82A          ; F822 50 06                                     P.
        jsr     GO UP          ; F824 20 AA F8                                   ..
        jmp     LF810          ; F827 4C 10 F8                                  L..

; ----------------------------------------------------------------------------
LF82A:  jsr     GO DOWN        ; F82A 20 B0 F8                                   ..
        jmp     LF810          ; F82D 4C 10 F8                                  L..

; ----------------------------------------------------------------------------
LF830:  clc                    ; F830 18                                        .
LF831:  lda     $F7            ; F831 A5 F7                                     ..
        adc     $F5            ; F833 65 F5                                     e.
        sta     $F7            ; F835 85 F7                                     ..
        bit     $F9            ; F837 24 F9                                     $.
        bvc     LF844          ; F839 50 09                                     P.
        jsr     UP1LINE        ; F83B 20 6F F8                                   o.
        jsr     LF887          ; F83E 20 87 F8                                   ..
        jmp     LF810          ; F841 4C 10 F8                                  L..

; ----------------------------------------------------------------------------
LF844:  jsr     LF85B          ; F844 20 5B F8                                   [.
        jsr     GO DOWN        ; F847 20 B0 F8                                   ..
        jmp     LF810          ; F84A 4C 10 F8                                  L..

; ----------------------------------------------------------------------------
; swaps content of EB,EC with F3,F4
SWAP EBF3:
        ldx     #$01           ; F84D A2 01                                     ..
LF84F:  lda     $EB,x          ; F84F B5 EB                                     ..
        ldy     $F3,x          ; F851 B4 F3                                     ..
        sta     $F3,x          ; F853 95 F3                                     ..
        sty     $EB,x          ; F855 94 EB                                     ..
        dex                    ; F857 CA                                        .
        bpl     LF84F          ; F858 10 F5                                     ..
        rts                    ; F85A 60                                        `

; ----------------------------------------------------------------------------
LF85B:  ldy     $FD            ; F85B A4 FD                                     ..
        iny                    ; F85D C8                                        .
        cpy     #$08           ; F85E C0 08                                     ..
        sty     $FD            ; F860 84 FD                                     ..
        bmi     RTS4           ; F862 30 0A                                     0.
        ldy     #$00           ; F864 A0 00                                     ..
        sty     $FD            ; F866 84 FD                                     ..
        inc     SCRNLO         ; F868 E6 FB                                     ..
        bne     RTS4           ; F86A D0 02                                     ..
        inc     SCRNHI         ; F86C E6 FC                                     ..
RTS4:   rts                    ; F86E 60                                        `

; ----------------------------------------------------------------------------
UP1LINE:lda     SCRNLO         ; F86F A5 FB                                     ..
        sec                    ; F871 38                                        8
        sbc     #$28           ; F872 E9 28                                     .(
        sta     SCRNLO         ; F874 85 FB                                     ..
        bcs     RTS5           ; F876 B0 02                                     ..
        dec     SCRNHI         ; F878 C6 FC                                     ..
RTS5:   rts                    ; F87A 60                                        `

; ----------------------------------------------------------------------------
DN1LINE:lda     SCRNLO         ; F87B A5 FB                                     ..
        clc                    ; F87D 18                                        .
        adc     #$28           ; F87E 69 28                                     i(
        sta     SCRNLO         ; F880 85 FB                                     ..
        bcc     RTS6           ; F882 90 02                                     ..
        inc     SCRNHI         ; F884 E6 FC                                     ..
RTS6:   rts                    ; F886 60                                        `

; ----------------------------------------------------------------------------
LF887:  jsr     LF85B          ; F887 20 5B F8                                   [.
LF88A:  ldy     $FD            ; F88A A4 FD                                     ..
        lda     MASK3,y        ; F88C B9 A2 F8                                  ...
        ldy     #$00           ; F88F A0 00                                     ..
        bit     $FA            ; F891 24 FA                                     $.
        bvc     INVERT         ; F893 50 06                                     P.
        ora     (SCRNLO),y     ; F895 11 FB                                     ..
        sta     (SCRNLO),y     ; F897 91 FB                                     ..
        clc                    ; F899 18                                        .
        rts                    ; F89A 60                                        `

; ----------------------------------------------------------------------------
INVERT: eor     #$FF           ; F89B 49 FF                                     I.
        and     (SCRNLO),y     ; F89D 31 FB                                     1.
        sta     (SCRNLO),y     ; F89F 91 FB                                     ..
        rts                    ; F8A1 60                                        `

; ----------------------------------------------------------------------------
; BIT MASK TABLE
MASK3:  .byte   $80,$40,$20,$10,$08,$04,$02,$01; F8A2 80 40 20 10 08 04 02 01   .@ .....
; ----------------------------------------------------------------------------
GO UP:  jsr     UP1LINE        ; F8AA 20 6F F8                                   o.
        jmp     LF88A          ; F8AD 4C 8A F8                                  L..

; ----------------------------------------------------------------------------
GO DOWN:jsr     DN1LINE        ; F8B0 20 7B F8                                   {.
        jmp     LF88A          ; F8B3 4C 8A F8                                  L..

; ----------------------------------------------------------------------------
LF8B6:  jsr     LF8D6          ; F8B6 20 D6 F8                                   ..
        jsr     LF88A          ; F8B9 20 8A F8                                   ..
        lda     $F4            ; F8BC A5 F4                                     ..
        cmp     $162B          ; F8BE CD 2B 16                                  .+.
        beq     LF8C5          ; F8C1 F0 02                                     ..
        bcs     LF8FA          ; F8C3 B0 35                                     .5
LF8C5:  sec                    ; F8C5 38                                        8
        sbc     $EC            ; F8C6 E5 EC                                     ..
        ror     $F9            ; F8C8 66 F9                                     f.
        bmi     LF8D1          ; F8CA 30 05                                     0.
        lda     $EC            ; F8CC A5 EC                                     ..
        sec                    ; F8CE 38                                        8
        sbc     $F4            ; F8CF E5 F4                                     ..
LF8D1:  sta     $F6            ; F8D1 85 F6                                     ..
        lda     $F6            ; F8D3 A5 F6                                     ..
        rts                    ; F8D5 60                                        `

; ----------------------------------------------------------------------------
LF8D6:  lda     $EC            ; F8D6 A5 EC                                     ..
        jsr     LF92E          ; F8D8 20 2E F9                                   ..
        lda     $EB            ; F8DB A5 EB                                     ..
        cmp     $162A          ; F8DD CD 2A 16                                  .*.
        beq     LF8E4          ; F8E0 F0 02                                     ..
        bcs     LF8FA          ; F8E2 B0 16                                     ..
LF8E4:  clc                    ; F8E4 18                                        .
        adc     $162E          ; F8E5 6D 2E 16                                  m..
        jmp     LF919          ; F8E8 4C 19 F9                                  L..

; ----------------------------------------------------------------------------
LF8EB:  bit     $1639          ; F8EB 2C 39 16                                  ,9.
        bmi     LF90A          ; F8EE 30 1A                                     0.
        sec                    ; F8F0 38                                        8
        lda     $162B          ; F8F1 AD 2B 16                                  .+.
        sbc     #$08           ; F8F4 E9 08                                     ..
        cmp     $EC            ; F8F6 C5 EC                                     ..
        bcs     LF8FD          ; F8F8 B0 03                                     ..
LF8FA:  jmp     (L160C)        ; F8FA 6C 0C 16                                  l..

; ----------------------------------------------------------------------------
LF8FD:  lda     $162A          ; F8FD AD 2A 16                                  .*.
        sec                    ; F900 38                                        8
        sbc     #$06           ; F901 E9 06                                     ..
        cmp     $EB            ; F903 C5 EB                                     ..
        bcc     LF8FA          ; F905 90 F3                                     ..
        jmp     LF8D6          ; F907 4C D6 F8                                  L..

; ----------------------------------------------------------------------------
LF90A:  lda     $1630          ; F90A AD 30 16                                  .0.
        sta     SCRNLO         ; F90D 85 FB                                     ..
        lda     $1631          ; F90F AD 31 16                                  .1.
        sta     SCRNHI         ; F912 85 FC                                     ..
        lda     $EE            ; F914 A5 EE                                     ..
        ror     a              ; F916 6A                                        j
        lda     $ED            ; F917 A5 ED                                     ..
LF919:  pha                    ; F919 48                                        H
        and     #$07           ; F91A 29 07                                     ).
        sta     $FD            ; F91C 85 FD                                     ..
        pla                    ; F91E 68                                        h
        ror     a              ; F91F 6A                                        j
        lsr     a              ; F920 4A                                        J
        lsr     a              ; F921 4A                                        J
        clc                    ; F922 18                                        .
        adc     SCRNLO         ; F923 65 FB                                     e.
        sta     SCRNLO         ; F925 85 FB                                     ..
        lda     SCRNHI         ; F927 A5 FC                                     ..
        adc     #$A0           ; F929 69 A0                                     i.
        sta     SCRNHI         ; F92B 85 FC                                     ..
        rts                    ; F92D 60                                        `

; ----------------------------------------------------------------------------
LF92E:  sta     SCRNLO         ; F92E 85 FB                                     ..
        lda     #$00           ; F930 A9 00                                     ..
        sta     SCRNHI         ; F932 85 FC                                     ..
        lda     $162B          ; F934 AD 2B 16                                  .+.
        sec                    ; F937 38                                        8
        sbc     SCRNLO         ; F938 E5 FB                                     ..
        bcc     LF8FA          ; F93A 90 BE                                     ..
        sta     SCRNLO         ; F93C 85 FB                                     ..
        asl     a              ; F93E 0A                                        .
        rol     SCRNHI         ; F93F 26 FC                                     &.
        asl     a              ; F941 0A                                        .
        rol     SCRNHI         ; F942 26 FC                                     &.
        adc     SCRNLO         ; F944 65 FB                                     e.
        bcc     LF94A          ; F946 90 02                                     ..
        inc     SCRNHI         ; F948 E6 FC                                     ..
LF94A:  asl     a              ; F94A 0A                                        .
        rol     SCRNHI         ; F94B 26 FC                                     &.
        asl     a              ; F94D 0A                                        .
        rol     SCRNHI         ; F94E 26 FC                                     &.
        asl     a              ; F950 0A                                        .
        rol     SCRNHI         ; F951 26 FC                                     &.
        sta     SCRNLO         ; F953 85 FB                                     ..
        rts                    ; F955 60                                        `

; ----------------------------------------------------------------------------
DO FFEED:
        ldx     $1633          ; F956 AE 33 16                                  .3.
        lda     #$00           ; F959 A9 00                                     ..
        sta     SCRNLO         ; F95B 85 FB                                     ..
        ldy     $1632          ; F95D AC 32 16                                  .2.
FFEED LOOP1:
        stx     SCRNHI         ; F960 86 FC                                     ..
FFEED LOOP2:
        dey                    ; F962 88                                        .
        sta     (SCRNLO),y     ; F963 91 FB                                     ..
        bne     FFEED LOOP2    ; F965 D0 FB                                     ..
        dex                    ; F967 CA                                        .
        cpx     #$A0           ; F968 E0 A0                                     ..
        bcs     FFEED LOOP1    ; F96A B0 F4                                     ..
        rts                    ; F96C 60                                        `

; ----------------------------------------------------------------------------
LF96D:  stx     $EB            ; F96D 86 EB                                     ..
        sty     $EC            ; F96F 84 EC                                     ..
        rts                    ; F971 60                                        `

; ----------------------------------------------------------------------------
        clc                    ; F972 18                                        .
        bcc     LF976          ; F973 90 01                                     ..
        sec                    ; F975 38                                        8
LF976:  ror     $FA            ; F976 66 FA                                     f.
        lsr     $FA            ; F978 46 FA                                     F.
        jsr     LF96D          ; F97A 20 6D F9                                   m.
        sty     YTMP1          ; F97D 8C 4A BF                                  .J.
        jsr     LF8D6          ; F980 20 D6 F8                                   ..
        jsr     LF88A          ; F983 20 8A F8                                   ..
        ldy     YTMP1          ; F986 AC 4A BF                                  .J.
        rts                    ; F989 60                                        `

; ----------------------------------------------------------------------------
        pha                    ; F98A 48                                        H
        lda     6530PBDD       ; F98B AD 03 17                                  ...
        ora     #$03           ; F98E 09 03                                     ..
        sta     6530PBDD       ; F990 8D 03 17                                  ...
        lda     6530PBD        ; F993 AD 02 17                                  ...
        and     #$FC           ; F996 29 FC                                     ).
        ora     #$02           ; F998 09 02                                     ..
        sta     6530PBD        ; F99A 8D 02 17                                  ...
        lda     6530PBDD       ; F99D AD 03 17                                  ...
        and     #$FC           ; F9A0 29 FC                                     ).
        sta     6530PBDD       ; F9A2 8D 03 17                                  ...
        pla                    ; F9A5 68                                        h
        rts                    ; F9A6 60                                        `

; ----------------------------------------------------------------------------
        jsr     LF9C1          ; F9A7 20 C1 F9                                   ..
        stx     XTMP3          ; F9AA 8E 4D BF                                  .M.
        jsr     LFA01          ; F9AD 20 01 FA                                   ..
        bcs     LF9B5          ; F9B0 B0 03                                     ..
        jmp     (L1612)        ; F9B2 6C 12 16                                  l..

; ----------------------------------------------------------------------------
LF9B5:  txa                    ; F9B5 8A                                        .
        ldx     XTMP3          ; F9B6 AE 4D BF                                  .M.
        sta     $166C,x        ; F9B9 9D 6C 16                                  .l.
        txa                    ; F9BC 8A                                        .
        clc                    ; F9BD 18                                        .
        adc     #$0C           ; F9BE 69 0C                                     i.
        tax                    ; F9C0 AA                                        .
LF9C1:  lda     #$16           ; F9C1 A9 16                                     ..
        sta     $1658,x        ; F9C3 9D 58 16                                  .X.
        txa                    ; F9C6 8A                                        .
        clc                    ; F9C7 18                                        .
        adc     #$5C           ; F9C8 69 5C                                     i\
        sta     $1654,x        ; F9CA 9D 54 16                                  .T.
        jsr     NEXTCHAR       ; F9CD 20 9D F3                                   ..
        bne     R/W            ; F9D0 D0 03                                     ..
        jmp     (L1612)        ; F9D2 6C 12 16                                  l..

; ----------------------------------------------------------------------------
R/W:    cmp     #$52           ; F9D5 C9 52                                     .R
        beq     IS R           ; F9D7 F0 0B                                     ..
        cmp     #$57           ; F9D9 C9 57                                     .W
        beq     IS W           ; F9DB F0 0F                                     ..
        jsr     LFAD7          ; F9DD 20 D7 FA                                   ..
        sta     $165C,x        ; F9E0 9D 5C 16                                  .\.
        rts                    ; F9E3 60                                        `

; ----------------------------------------------------------------------------
IS R:   iny                    ; F9E4 C8                                        .
        jsr     DO R           ; F9E5 20 31 FA                                   1.
        sta     $1654,x        ; F9E8 9D 54 16                                  .T.
        rts                    ; F9EB 60                                        `

; ----------------------------------------------------------------------------
IS W:   iny                    ; F9EC C8                                        .
        stx     XTMP3          ; F9ED 8E 4D BF                                  .M.
        jsr     DO W           ; F9F0 20 EE FA                                   ..
        ldx     XTMP3          ; F9F3 AE 4D BF                                  .M.
        lda     $DF            ; F9F6 A5 DF                                     ..
        sta     $1654,x        ; F9F8 9D 54 16                                  .T.
        lda     $E0            ; F9FB A5 E0                                     ..
        sta     $1658,x        ; F9FD 9D 58 16                                  .X.
        rts                    ; FA00 60                                        `

; ----------------------------------------------------------------------------
LFA01:  jsr     NEXTCHAR       ; FA01 20 9D F3                                   ..
        ldx     #$04           ; FA04 A2 04                                     ..
        cmp     #$3C           ; FA06 C9 3C                                     .<
        bpl     LFA0C          ; FA08 10 02                                     ..
LFA0A:  clc                    ; FA0A 18                                        .
        rts                    ; FA0B 60                                        `

; ----------------------------------------------------------------------------
LFA0C:  cmp     #$3F           ; FA0C C9 3F                                     .?
        bpl     LFA0A          ; FA0E 10 FA                                     ..
        iny                    ; FA10 C8                                        .
        cmp     #$3D           ; FA11 C9 3D                                     .=
        beq     LFA2F          ; FA13 F0 1A                                     ..
        php                    ; FA15 08                                        .
        lda     (INPUTLB),y    ; FA16 B1 E7                                     ..
        plp                    ; FA18 28                                        (
        bpl     LFA27          ; FA19 10 0C                                     ..
        cmp     #$3E           ; FA1B C9 3E                                     .>
        beq     LFA2D          ; FA1D F0 0E                                     ..
        dex                    ; FA1F CA                                        .
        cmp     #$3D           ; FA20 C9 3D                                     .=
        beq     LFA2D          ; FA22 F0 09                                     ..
        dex                    ; FA24 CA                                        .
        bpl     LFA2E          ; FA25 10 07                                     ..
LFA27:  inx                    ; FA27 E8                                        .
        inx                    ; FA28 E8                                        .
        cmp     #$3D           ; FA29 C9 3D                                     .=
        bne     LFA2F          ; FA2B D0 02                                     ..
LFA2D:  iny                    ; FA2D C8                                        .
LFA2E:  dex                    ; FA2E CA                                        .
LFA2F:  sec                    ; FA2F 38                                        8
        rts                    ; FA30 60                                        `

; ----------------------------------------------------------------------------
DO R:   jsr     NEXTCHAR       ; FA31 20 9D F3                                   ..
        stx     XTMP3          ; FA34 8E 4D BF                                  .M.
        ldx     #$04           ; FA37 A2 04                                     ..
; CHECKS INPUT AGAINST FSYXA UPPER CASE
FSYXAUC:cmp     FSYXA,x        ; FA39 DD 4D FA                                  .M.
        beq     LFA44          ; FA3C F0 06                                     ..
        dex                    ; FA3E CA                                        .
        bpl     FSYXAUC        ; FA3F 10 F8                                     ..
        jmp     (L1612)        ; FA41 6C 12 16                                  l..

; ----------------------------------------------------------------------------
LFA44:  txa                    ; FA44 8A                                        .
        clc                    ; FA45 18                                        .
        adc     #$70           ; FA46 69 70                                     ip
        ldx     XTMP3          ; FA48 AE 4D BF                                  .M.
        iny                    ; FA4B C8                                        .
        rts                    ; FA4C 60                                        `

; ----------------------------------------------------------------------------
; SEE $FA39
FSYXA:  .byte   $46,$53,$59,$58,$41; FA4D 46 53 59 58 41                        FSYXA
; ----------------------------------------------------------------------------
        lda     $1654,x        ; FA52 BD 54 16                                  .T.
        sta     $DF            ; FA55 85 DF                                     ..
        lda     $1658,x        ; FA57 BD 58 16                                  .X.
        sta     $E0            ; FA5A 85 E0                                     ..
        lda     $1660,x        ; FA5C BD 60 16                                  .`.
        sta     $E1            ; FA5F 85 E1                                     ..
        lda     $1664,x        ; FA61 BD 64 16                                  .d.
        sta     $E2            ; FA64 85 E2                                     ..
        ldy     #$00           ; FA66 A0 00                                     ..
        lda     ($DF),y        ; FA68 B1 DF                                     ..
        cmp     ($E1),y        ; FA6A D1 E1                                     ..
        php                    ; FA6C 08                                        .
        ldy     $166C,x        ; FA6D BC 6C 16                                  .l.
        dey                    ; FA70 88                                        .
        bne     LFA75          ; FA71 D0 02                                     ..
        plp                    ; FA73 28                                        (
LFA74:  rts                    ; FA74 60                                        `

; ----------------------------------------------------------------------------
LFA75:  dey                    ; FA75 88                                        .
        bne     LFA7D          ; FA76 D0 05                                     ..
        plp                    ; FA78 28                                        (
        beq     LFA8B          ; FA79 F0 10                                     ..
        bne     LFA74          ; FA7B D0 F7                                     ..
LFA7D:  dey                    ; FA7D 88                                        .
        bne     LFA85          ; FA7E D0 05                                     ..
        plp                    ; FA80 28                                        (
        bne     LFA8B          ; FA81 D0 08                                     ..
LFA83:  sec                    ; FA83 38                                        8
        rts                    ; FA84 60                                        `

; ----------------------------------------------------------------------------
LFA85:  dey                    ; FA85 88                                        .
        bne     LFA8D          ; FA86 D0 05                                     ..
        plp                    ; FA88 28                                        (
        bne     LFA83          ; FA89 D0 F8                                     ..
LFA8B:  clc                    ; FA8B 18                                        .
        rts                    ; FA8C 60                                        `

; ----------------------------------------------------------------------------
LFA8D:  dey                    ; FA8D 88                                        .
        bne     LFA94          ; FA8E D0 04                                     ..
        plp                    ; FA90 28                                        (
        beq     LFA8B          ; FA91 F0 F8                                     ..
        php                    ; FA93 08                                        .
LFA94:  plp                    ; FA94 28                                        (
        beq     LFA83          ; FA95 F0 EC                                     ..
        bcs     LFA8B          ; FA97 B0 F2                                     ..
        bcc     LFA83          ; FA99 90 E8                                     ..
        ldx     #$02           ; FA9B A2 02                                     ..
LFA9D:  lda     $164E,x        ; FA9D BD 4E 16                                  .N.
        cmp     DDHI           ; FAA0 C5 DE                                     ..
        bne     LFAAB          ; FAA2 D0 07                                     ..
        lda     $164B,x        ; FAA4 BD 4B 16                                  .K.
        cmp     DDLO           ; FAA7 C5 DD                                     ..
        beq     LFAAE          ; FAA9 F0 03                                     ..
LFAAB:  dex                    ; FAAB CA                                        .
        bpl     LFA9D          ; FAAC 10 EF                                     ..
LFAAE:  rts                    ; FAAE 60                                        `

; ----------------------------------------------------------------------------
        ldy     #$00           ; FAAF A0 00                                     ..
        ldx     #$02           ; FAB1 A2 02                                     ..
LFAB3:  lda     $164E,x        ; FAB3 BD 4E 16                                  .N.
        cmp     #$FF           ; FAB6 C9 FF                                     ..
        beq     LFAC6          ; FAB8 F0 0C                                     ..
        sta     $E0            ; FABA 85 E0                                     ..
        lda     $164B,x        ; FABC BD 4B 16                                  .K.
        sta     $DF            ; FABF 85 DF                                     ..
        lda     $1651,x        ; FAC1 BD 51 16                                  .Q.
        sta     ($DF),y        ; FAC4 91 DF                                     ..
LFAC6:  dex                    ; FAC6 CA                                        .
        bpl     LFAB3          ; FAC7 10 EA                                     ..
        lda     #$FF           ; FAC9 A9 FF                                     ..
        ldx     #$03           ; FACB A2 03                                     ..
LFACD:  sta     $164D,x        ; FACD 9D 4D 16                                  .M.
        dex                    ; FAD0 CA                                        .
        bne     LFACD          ; FAD1 D0 FA                                     ..
        stx     $164A          ; FAD3 8E 4A 16                                  .J.
        rts                    ; FAD6 60                                        `

; ----------------------------------------------------------------------------
LFAD7:  jsr     LFB06          ; FAD7 20 06 FB                                   ..
        bcc     LFAF9          ; FADA 90 1D                                     ..
        lda     $E4            ; FADC A5 E4                                     ..
        beq     LFAEB          ; FADE F0 0B                                     ..
        cmp     #$FF           ; FAE0 C9 FF                                     ..
        bne     LFAE8          ; FAE2 D0 04                                     ..
        bit     $E3            ; FAE4 24 E3                                     $.
        bmi     LFAEB          ; FAE6 30 03                                     0.
LFAE8:  jmp     (L160E)        ; FAE8 6C 0E 16                                  l..

; ----------------------------------------------------------------------------
LFAEB:  lda     $E3            ; FAEB A5 E3                                     ..
        rts                    ; FAED 60                                        `

; ----------------------------------------------------------------------------
DO W:   ldx     #$DF           ; FAEE A2 DF                                     ..
        bne     LFAF4          ; FAF0 D0 02                                     ..
LFAF2:  ldx     #$DD           ; FAF2 A2 DD                                     ..
LFAF4:  jsr     LFB06          ; FAF4 20 06 FB                                   ..
        bcs     LFAFC          ; FAF7 B0 03                                     ..
LFAF9:  jmp     (L1612)        ; FAF9 6C 12 16                                  l..

; ----------------------------------------------------------------------------
LFAFC:  lda     $E3            ; FAFC A5 E3                                     ..
        sta     $00,x          ; FAFE 95 00                                     ..
        lda     $E4            ; FB00 A5 E4                                     ..
        sta     $01,x          ; FB02 95 01                                     ..
        rts                    ; FB04 60                                        `

; ----------------------------------------------------------------------------
        iny                    ; FB05 C8                                        .
LFB06:  txa                    ; FB06 8A                                        .
        pha                    ; FB07 48                                        H
        lda     #$00           ; FB08 A9 00                                     ..
        sta     $E3            ; FB0A 85 E3                                     ..
        sta     $E4            ; FB0C 85 E4                                     ..
        sta     $1645          ; FB0E 8D 45 16                                  .E.
; MINUS OR PLUS
-OR+:   ldx     #$E5           ; FB11 A2 E5                                     ..
        jsr     NEXTCHAR       ; FB13 20 9D F3                                   ..
        beq     LFB27          ; FB16 F0 0F                                     ..
        cmp     #$2D           ; FB18 C9 2D                                     .-
        php                    ; FB1A 08                                        .
        beq     LFB2F          ; FB1B F0 12                                     ..
        cmp     #$2B           ; FB1D C9 2B                                     .+
        beq     LFB2F          ; FB1F F0 0E                                     ..
        bit     $1645          ; FB21 2C 45 16                                  ,E.
        bpl     LFB32          ; FB24 10 0C                                     ..
        plp                    ; FB26 28                                        (
LFB27:  rol     $1645          ; FB27 2E 45 16                                  .E.
LFB2A:  pla                    ; FB2A 68                                        h
        tax                    ; FB2B AA                                        .
        jmp     GETCHAR2       ; FB2C 4C A8 F3                                  L..

; ----------------------------------------------------------------------------
LFB2F:  jsr     SPACELOOP      ; FB2F 20 9C F3                                   ..
LFB32:  iny                    ; FB32 C8                                        .
        cmp     $1622          ; FB33 CD 22 16                                  .".
        beq     LFB4D          ; FB36 F0 15                                     ..
        cmp     $1623          ; FB38 CD 23 16                                  .#.
        beq     LFB6B          ; FB3B F0 2E                                     ..
        cmp     $1624          ; FB3D CD 24 16                                  .$.
        beq     LFB74          ; FB40 F0 32                                     .2
        cmp     $1621          ; FB42 CD 21 16                                  .!.
        beq     LFB89          ; FB45 F0 42                                     .B
        dey                    ; FB47 88                                        .
        bit     $1641          ; FB48 2C 41 16                                  ,A.
        bmi     LFB6B          ; FB4B 30 1E                                     0.
LFB4D:  jsr     LF340          ; FB4D 20 40 F3                                   @.
        bcc     LFB70          ; FB50 90 1E                                     ..
LFB52:  dec     $1645          ; FB52 CE 45 16                                  .E.
        plp                    ; FB55 28                                        (
        bne     LFB5B          ; FB56 D0 03                                     ..
        jsr     LFBA2          ; FB58 20 A2 FB                                   ..
LFB5B:  lda     $E3            ; FB5B A5 E3                                     ..
        clc                    ; FB5D 18                                        .
        adc     $E5            ; FB5E 65 E5                                     e.
        sta     $E3            ; FB60 85 E3                                     ..
        lda     $E4            ; FB62 A5 E4                                     ..
        adc     $E6            ; FB64 65 E6                                     e.
        sta     $E4            ; FB66 85 E4                                     ..
        jmp     -OR+           ; FB68 4C 11 FB                                  L..

; ----------------------------------------------------------------------------
LFB6B:  jsr     LF36C          ; FB6B 20 6C F3                                   l.
        bcs     LFB52          ; FB6E B0 E2                                     ..
LFB70:  plp                    ; FB70 28                                        (
        clc                    ; FB71 18                                        .
        bcc     LFB2A          ; FB72 90 B6                                     ..
LFB74:  lda     (INPUTLB),y    ; FB74 B1 E7                                     ..
        beq     LFB70          ; FB76 F0 F8                                     ..
        sta     $E5            ; FB78 85 E5                                     ..
        lda     #$00           ; FB7A A9 00                                     ..
        sta     $E6            ; FB7C 85 E6                                     ..
        iny                    ; FB7E C8                                        .
        lda     (INPUTLB),y    ; FB7F B1 E7                                     ..
        cmp     $1624          ; FB81 CD 24 16                                  .$.
        bne     LFB70          ; FB84 D0 EA                                     ..
        iny                    ; FB86 C8                                        .
        bne     LFB52          ; FB87 D0 C9                                     ..
LFB89:  lda     $EF            ; FB89 A5 EF                                     ..
        sta     $E5            ; FB8B 85 E5                                     ..
        lda     $F0            ; FB8D A5 F0                                     ..
        sta     $E6            ; FB8F 85 E6                                     ..
        jmp     LFB52          ; FB91 4C 52 FB                                  LR.

; ----------------------------------------------------------------------------
; returns with $DF+$DD, $E0+$DE
DDplusDF:
        clc                    ; FB94 18                                        .
        lda     $00,x          ; FB95 B5 00                                     ..
        adc     DDLO           ; FB97 65 DD                                     e.
        sta     DDLO           ; FB99 85 DD                                     ..
        lda     $01,x          ; FB9B B5 01                                     ..
        adc     DDHI           ; FB9D 65 DE                                     e.
        sta     DDHI           ; FB9F 85 DE                                     ..
        rts                    ; FBA1 60                                        `

; ----------------------------------------------------------------------------
LFBA2:  lda     #$00           ; FBA2 A9 00                                     ..
        sec                    ; FBA4 38                                        8
        sbc     $00,x          ; FBA5 F5 00                                     ..
        sta     $00,x          ; FBA7 95 00                                     ..
        lda     #$00           ; FBA9 A9 00                                     ..
        sbc     $01,x          ; FBAB F5 01                                     ..
        sta     $01,x          ; FBAD 95 01                                     ..
        rts                    ; FBAF 60                                        `

; ----------------------------------------------------------------------------
; returns with $DE->$E0, $DD->$DF
DDtoDF: lda     DDHI           ; FBB0 A5 DE                                     ..
        sta     $01,x          ; FBB2 95 01                                     ..
        lda     DDLO           ; FBB4 A5 DD                                     ..
        sta     $00,x          ; FBB6 95 00                                     ..
        rts                    ; FBB8 60                                        `

; ----------------------------------------------------------------------------
; returns with $E4->DE, $E3->$DD
E3toDD: lda     $01,x          ; FBB9 B5 01                                     ..
        sta     DDHI           ; FBBB 85 DE                                     ..
        lda     $00,x          ; FBBD B5 00                                     ..
        sta     DDLO           ; FBBF 85 DD                                     ..
        rts                    ; FBC1 60                                        `

; ----------------------------------------------------------------------------
        jsr     LFC5F          ; FBC2 20 5F FC                                   _.
        bcc     LFC15          ; FBC5 90 4E                                     .N
        lda     $E1            ; FBC7 A5 E1                                     ..
        sec                    ; FBC9 38                                        8
        sbc     DDLO           ; FBCA E5 DD                                     ..
        sta     $E3            ; FBCC 85 E3                                     ..
        lda     $E2            ; FBCE A5 E2                                     ..
        sbc     DDHI           ; FBD0 E5 DE                                     ..
        sta     $E4            ; FBD2 85 E4                                     ..
; MODIFIED $40 -> $41
MOD1:   bcc     KIMRESET       ; FBD4 90 41                                     .A
        ldx     #$E3           ; FBD6 A2 E3                                     ..
        jsr     E3toDD         ; FBD8 20 B9 FB                                   ..
        ldx     #$DF           ; FBDB A2 DF                                     ..
        jsr     DDplusDF       ; FBDD 20 94 FB                                   ..
        ldy     #$00           ; FBE0 A0 00                                     ..
        ldx     $E6            ; FBE2 A6 E6                                     ..
        beq     LFBF9          ; FBE4 F0 13                                     ..
LFBE6:  lda     ($DF),y        ; FBE6 B1 DF                                     ..
        sta     (DDLO),y       ; FBE8 91 DD                                     ..
        dey                    ; FBEA 88                                        .
        dec     $E0            ; FBEB C6 E0                                     ..
        dec     DDHI           ; FBED C6 DE                                     ..
LFBEF:  lda     ($DF),y        ; FBEF B1 DF                                     ..
        sta     (DDLO),y       ; FBF1 91 DD                                     ..
        dey                    ; FBF3 88                                        .
        bne     LFBEF          ; FBF4 D0 F9                                     ..
        dex                    ; FBF6 CA                                        .
        bne     LFBE6          ; FBF7 D0 ED                                     ..
LFBF9:  ldx     $E5            ; FBF9 A6 E5                                     ..
        beq     LFC11          ; FBFB F0 14                                     ..
        lda     ($DF),y        ; FBFD B1 DF                                     ..
; ???
??:     .byte   $91            ; FBFF 91                                        .
RESET:  cld                    ; FC00 D8                                        .
        ldx     #$FF           ; FC01 A2 FF                                     ..
        txs                    ; FC03 9A                                        .
        lda     #$00           ; FC04 A9 00                                     ..
        sta     6530PADD       ; FC06 8D 01 17                                  ...
        lda     6530IO         ; FC09 AD 00 17                                  ...
        bpl     LFC14          ; FC0C 10 06                                     ..
        asl     a              ; FC0E 0A                                        .
        sta     $0F            ; FC0F 85 0F                                     ..
LFC11:  jmp     RESET2         ; FC11 4C 9B FC                                  L..

; ----------------------------------------------------------------------------
LFC14:  asl     a              ; FC14 0A                                        .
LFC15:  bpl     LFC1A          ; FC15 10 03                                     ..
; DOES KIM RESET
KIMRESET:
        jmp     KIMRST         ; FC17 4C 22 1C                                  L".

; ----------------------------------------------------------------------------
LFC1A:  cld                    ; FC1A D8                                        .
        sei                    ; FC1B 78                                        x
        ldx     #$FF           ; FC1C A2 FF                                     ..
        txs                    ; FC1E 9A                                        .
        lda     #$00           ; FC1F A9 00                                     ..
        sta     6522-DDRA      ; FC21 8D 83 15                                  ...
        lda     6522-PCR       ; FC24 AD 8C 15                                  ...
        and     #$F0           ; FC27 29 F0                                     ).
        ora     $0E            ; FC29 05 0E                                     ..
        sta     6522-PCR       ; FC2B 8D 8C 15                                  ...
LFC2E:  jsr     WAITFORIO      ; FC2E 20 7F FC                                   ..
        cmp     #$58           ; FC31 C9 58                                     .X
        bne     LFC2E          ; FC33 D0 F9                                     ..
        jsr     WAITFORIO      ; FC35 20 7F FC                                   ..
        jsr     WAITFORIO      ; FC38 20 7F FC                                   ..
LFC3B:  jsr     WAITFORIO      ; FC3B 20 7F FC                                   ..
        jsr     WAITFORIO      ; FC3E 20 7F FC                                   ..
        sta     L0004          ; FC41 85 04                                     ..
        jsr     WAITFORIO      ; FC43 20 7F FC                                   ..
        sta     $05            ; FC46 85 05                                     ..
        jsr     WAITFORIO      ; FC48 20 7F FC                                   ..
        sta     $00            ; FC4B 85 00                                     ..
        jsr     WAITFORIO      ; FC4D 20 7F FC                                   ..
        sta     $01            ; FC50 85 01                                     ..
        jsr     WAITFORIO      ; FC52 20 7F FC                                   ..
        sta     $02            ; FC55 85 02                                     ..
        jsr     WAITFORIO      ; FC57 20 7F FC                                   ..
        sta     $03            ; FC5A 85 03                                     ..
        ldx     #$00           ; FC5C A2 00                                     ..
        txa                    ; FC5E 8A                                        .
LFC5F:  sec                    ; FC5F 38                                        8
        sbc     $02            ; FC60 E5 02                                     ..
        sta     $02            ; FC62 85 02                                     ..
        txa                    ; FC64 8A                                        .
        sbc     $03            ; FC65 E5 03                                     ..
        sta     $03            ; FC67 85 03                                     ..
LFC69:  jsr     WAITFORIO      ; FC69 20 7F FC                                   ..
        sta     ($00,x)        ; FC6C 81 00                                     ..
        inc     $00            ; FC6E E6 00                                     ..
        bne     LFC74          ; FC70 D0 02                                     ..
        inc     $01            ; FC72 E6 01                                     ..
LFC74:  inc     $02            ; FC74 E6 02                                     ..
        bne     LFC69          ; FC76 D0 F1                                     ..
        inc     $03            ; FC78 E6 03                                     ..
        bne     LFC69          ; FC7A D0 ED                                     ..
        jmp     (L0004)        ; FC7C 6C 04 00                                  l..

; ----------------------------------------------------------------------------
; LOOPS UNTIL INPUT ON 6522. INTERRUPT FLAG BIT 1 SET ON IO AT 6522 PORTA
WAITFORIO:
        lda     6522-IFR       ; FC7F AD 8D 15                                  ...
        and     #$02           ; FC82 29 02                                     ).
        beq     WAITFORIO      ; FC84 F0 F9                                     ..
        lda     6522-INPUTA    ; FC86 AD 81 15                                  ...
        pha                    ; FC89 48                                        H
        lda     6522-PCR       ; FC8A AD 8C 15                                  ...
        and     #$F0           ; FC8D 29 F0                                     ).
        ora     #$0C           ; FC8F 09 0C                                     ..
        sta     6522-PCR       ; FC91 8D 8C 15                                  ...
        ora     #$0E           ; FC94 09 0E                                     ..
        sta     6522-PCR       ; FC96 8D 8C 15                                  ...
        pla                    ; FC99 68                                        h
        rts                    ; FC9A 60                                        `

; ----------------------------------------------------------------------------
; RESET CONTINUES IF 6530IO BIT 7 IS 1. CTRL+RESET?
RESET2: cld                    ; FC9B D8                                        .
        ldx     #$FF           ; FC9C A2 FF                                     ..
        txs                    ; FC9E 9A                                        .
        sei                    ; FC9F 78                                        x
        lda     #$00           ; FCA0 A9 00                                     ..
        sta     6522-INPUTB    ; FCA2 8D 80 15                                  ...
        sta     6522-IER       ; FCA5 8D 8E 15                                  ...
        sta     6522-DDRA      ; FCA8 8D 83 15                                  ...
        lda     #$EE           ; FCAB A9 EE                                     ..
        sta     6522-PCR       ; FCAD 8D 8C 15                                  ...
        lda     #$FF           ; FCB0 A9 FF                                     ..
        sta     6522-DDRB      ; FCB2 8D 82 15                                  ...
        lda     #$00           ; FCB5 A9 00                                     ..
        sta     $06            ; FCB7 85 06                                     ..
        sta     $08            ; FCB9 85 08                                     ..
        lda     #$20           ; FCBB A9 20                                     . 
        sta     $07            ; FCBD 85 07                                     ..
        sta     $09            ; FCBF 85 09                                     ..
        ldx     #$00           ; FCC1 A2 00                                     ..
        stx     $0C            ; FCC3 86 0C                                     ..
        stx     $0D            ; FCC5 86 0D                                     ..
        stx     $0E            ; FCC7 86 0E                                     ..
LFCC9:  jsr     LFD9B          ; FCC9 20 9B FD                                   ..
        bcs     LFCEA          ; FCCC B0 1C                                     ..
        bit     $0F            ; FCCE 24 0F                                     $.
        bmi     LFCE7          ; FCD0 30 15                                     0.
        cmp     #$20           ; FCD2 C9 20                                     . 
        bne     LFCE4          ; FCD4 D0 0E                                     ..
        inc     $0C            ; FCD6 E6 0C                                     ..
        ldy     $0C            ; FCD8 A4 0C                                     ..
        cpy     #$3F           ; FCDA C0 3F                                     .?
        bcc     LFCEA          ; FCDC 90 0C                                     ..
        jsr     LFD31          ; FCDE 20 31 FD                                   1.
        jmp     LFCEA          ; FCE1 4C EA FC                                  L..

; ----------------------------------------------------------------------------
LFCE4:  jsr     LFD31          ; FCE4 20 31 FD                                   1.
LFCE7:  jsr     LFCF0          ; FCE7 20 F0 FC                                   ..
LFCEA:  jsr     LFD4C          ; FCEA 20 4C FD                                   L.
        jmp     LFCC9          ; FCED 4C C9 FC                                  L..

; ----------------------------------------------------------------------------
LFCF0:  pha                    ; FCF0 48                                        H
        lda     $06            ; FCF1 A5 06                                     ..
        sta     $0A            ; FCF3 85 0A                                     ..
        lda     $07            ; FCF5 A5 07                                     ..
        sta     $0B            ; FCF7 85 0B                                     ..
        inc     $0A            ; FCF9 E6 0A                                     ..
        bne     LFCFF          ; FCFB D0 02                                     ..
        inc     $0B            ; FCFD E6 0B                                     ..
LFCFF:  lda     $0A            ; FCFF A5 0A                                     ..
        cmp     #$00           ; FD01 C9 00                                     ..
        bne     LFD13          ; FD03 D0 0E                                     ..
        lda     $0B            ; FD05 A5 0B                                     ..
        cmp     #$80           ; FD07 C9 80                                     ..
        bne     LFD13          ; FD09 D0 08                                     ..
        lda     #$00           ; FD0B A9 00                                     ..
        sta     $0A            ; FD0D 85 0A                                     ..
        lda     #$20           ; FD0F A9 20                                     . 
        sta     $0B            ; FD11 85 0B                                     ..
LFD13:  lda     $0A            ; FD13 A5 0A                                     ..
        cmp     $08            ; FD15 C5 08                                     ..
        bne     0A0Bto0607     ; FD17 D0 0C                                     ..
        lda     $0B            ; FD19 A5 0B                                     ..
        cmp     $09            ; FD1B C5 09                                     ..
        bne     0A0Bto0607     ; FD1D D0 06                                     ..
        jsr     LFD4C          ; FD1F 20 4C FD                                   L.
        jmp     LFD13          ; FD22 4C 13 FD                                  L..

; ----------------------------------------------------------------------------
; returns with $0A,$0B in $06,$07
0A0Bto0607:
        pla                    ; FD25 68                                        h
        sta     ($06,x)        ; FD26 81 06                                     ..
        lda     $0A            ; FD28 A5 0A                                     ..
        sta     $06            ; FD2A 85 06                                     ..
        lda     $0B            ; FD2C A5 0B                                     ..
        sta     $07            ; FD2E 85 07                                     ..
        rts                    ; FD30 60                                        `

; ----------------------------------------------------------------------------
LFD31:  ldy     $0C            ; FD31 A4 0C                                     ..
        beq     LFD4B          ; FD33 F0 16                                     ..
        pha                    ; FD35 48                                        H
        cpy     #$01           ; FD36 C0 01                                     ..
        bne     LFD3F          ; FD38 D0 05                                     ..
        lda     #$20           ; FD3A A9 20                                     . 
        jmp     LFD43          ; FD3C 4C 43 FD                                  LC.

; ----------------------------------------------------------------------------
LFD3F:  lda     $0C            ; FD3F A5 0C                                     ..
        ora     #$80           ; FD41 09 80                                     ..
LFD43:  jsr     LFCF0          ; FD43 20 F0 FC                                   ..
        lda     #$00           ; FD46 A9 00                                     ..
        sta     $0C            ; FD48 85 0C                                     ..
        pla                    ; FD4A 68                                        h
LFD4B:  rts                    ; FD4B 60                                        `

; ----------------------------------------------------------------------------
LFD4C:  bit     $0F            ; FD4C 24 0F                                     $.
        bmi     LFD60          ; FD4E 30 10                                     0.
        ldy     $0D            ; FD50 A4 0D                                     ..
        beq     LFD60          ; FD52 F0 0C                                     ..
        lda     #$20           ; FD54 A9 20                                     . 
        jsr     LFDB9          ; FD56 20 B9 FD                                   ..
        bcs     RTS9           ; FD59 B0 3F                                     .?
        dec     $0D            ; FD5B C6 0D                                     ..
        jmp     RTS9           ; FD5D 4C 9A FD                                  L..

; ----------------------------------------------------------------------------
LFD60:  lda     $06            ; FD60 A5 06                                     ..
        cmp     $08            ; FD62 C5 08                                     ..
        bne     LFD6C          ; FD64 D0 06                                     ..
        lda     $07            ; FD66 A5 07                                     ..
        cmp     $09            ; FD68 C5 09                                     ..
        beq     RTS9           ; FD6A F0 2E                                     ..
LFD6C:  lda     ($08,x)        ; FD6C A1 08                                     ..
        bpl     LFD7B          ; FD6E 10 0B                                     ..
        bit     $0F            ; FD70 24 0F                                     $.
        bmi     LFD7B          ; FD72 30 07                                     0.
        and     #$7F           ; FD74 29 7F                                     ).
        sta     $0D            ; FD76 85 0D                                     ..
        jmp     LFD80          ; FD78 4C 80 FD                                  L..

; ----------------------------------------------------------------------------
LFD7B:  jsr     LFDB9          ; FD7B 20 B9 FD                                   ..
        bcs     RTS9           ; FD7E B0 1A                                     ..
LFD80:  inc     $08            ; FD80 E6 08                                     ..
        bne     LFD86          ; FD82 D0 02                                     ..
        inc     $09            ; FD84 E6 09                                     ..
LFD86:  lda     $08            ; FD86 A5 08                                     ..
        cmp     #$00           ; FD88 C9 00                                     ..
        bne     RTS9           ; FD8A D0 0E                                     ..
        lda     $09            ; FD8C A5 09                                     ..
        cmp     #$80           ; FD8E C9 80                                     ..
        bne     RTS9           ; FD90 D0 08                                     ..
        lda     #$00           ; FD92 A9 00                                     ..
        sta     $08            ; FD94 85 08                                     ..
        lda     #$20           ; FD96 A9 20                                     . 
        sta     $09            ; FD98 85 09                                     ..
RTS9:   rts                    ; FD9A 60                                        `

; ----------------------------------------------------------------------------
LFD9B:  lda     6522-IFR       ; FD9B AD 8D 15                                  ...
        sec                    ; FD9E 38                                        8
        and     #$02           ; FD9F 29 02                                     ).
        beq     RTS10          ; FDA1 F0 15                                     ..
        lda     6522-INPUTA    ; FDA3 AD 81 15                                  ...
        pha                    ; FDA6 48                                        H
        lda     6522-PCR       ; FDA7 AD 8C 15                                  ...
        and     #$F0           ; FDAA 29 F0                                     ).
        ora     #$0C           ; FDAC 09 0C                                     ..
        sta     6522-PCR       ; FDAE 8D 8C 15                                  ...
        ora     #$0E           ; FDB1 09 0E                                     ..
        sta     6522-PCR       ; FDB3 8D 8C 15                                  ...
        pla                    ; FDB6 68                                        h
        clc                    ; FDB7 18                                        .
RTS10:  rts                    ; FDB8 60                                        `

; ----------------------------------------------------------------------------
LFDB9:  pha                    ; FDB9 48                                        H
        sec                    ; FDBA 38                                        8
        bit     $0E            ; FDBB 24 0E                                     $.
        bmi     LFDD5          ; FDBD 30 16                                     0.
        sta     6522-INPUTB    ; FDBF 8D 80 15                                  ...
        lda     6522-PCR       ; FDC2 AD 8C 15                                  ...
        and     #$0F           ; FDC5 29 0F                                     ).
        ora     #$C0           ; FDC7 09 C0                                     ..
        sta     6522-PCR       ; FDC9 8D 8C 15                                  ...
        ora     #$E0           ; FDCC 09 E0                                     ..
        sta     6522-PCR       ; FDCE 8D 8C 15                                  ...
        sec                    ; FDD1 38                                        8
        ror     $0E            ; FDD2 66 0E                                     f.
        clc                    ; FDD4 18                                        .
LFDD5:  lda     6522-IFR       ; FDD5 AD 8D 15                                  ...
        and     #$11           ; FDD8 29 11                                     ).
        beq     LFDE0          ; FDDA F0 04                                     ..
        lda     #$00           ; FDDC A9 00                                     ..
        sta     $0E            ; FDDE 85 0E                                     ..
LFDE0:  pla                    ; FDE0 68                                        h
        rts                    ; FDE1 60                                        `

; ----------------------------------------------------------------------------
NMIV:   .addr   NMI            ; FFFA 1C 1C                                     ..
RSTV:   .addr   RESET          ; FFFC 00 FC                                     ..
IRQV:   .addr   IRQ            ; FFFE 1F 1C                                     ..
